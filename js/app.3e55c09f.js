(function(){"use strict";var e={390:function(e,t,a){var l={};a.r(l),a.d(l,{apiEndpoint:function(){return _},apiEndpointDev:function(){return V},basePath:function(){return S},charts:function(){return C},mapPaths:function(){return H},packetFormats:function(){return O},packetList:function(){return A},systemId:function(){return b},wsEndpoint:function(){return W},wsEndpointDev:function(){return U}});var i=a(9242),n=a(3396),o=a(7718);function s(e,t){const a=(0,n.up)("router-view");return(0,n.wg)(),(0,n.j4)(o.q,null,{default:(0,n.w5)((()=>[(0,n.Wm)(a)])),_:1})}var r=a(89);const u={},m=(0,r.Z)(u,[["render",s]]);var d=m,c=(a(9773),a(8957));const p={dark:!0,colors:{primary:"#2196F3",background:"#121212",surface:"#303030","primary-darken-1":"#00FF00",secondary:"#0000FF","secondary-darken-1":"#FF0000",info:"#29b6f6",success:"#66bb6a",error:"#f44336",warning:"#ffa726"}};var f=(0,c.Rd)({theme:{defaultTheme:"customTheme",themes:{customTheme:p}}});async function h(){const e=await a.e(461).then(a.t.bind(a,3657,23));e.load({google:{families:["Roboto:100,300,400,500,700,900&display=swap"]}})}var w=a(2483),g=(a(7658),a(7139)),v=a(4870),y=a(7327),k=(a(3767),a(8585),a(8696),a(6265)),T=a.n(k);const b="launch2023",_="https://telemeter.fujiy.dev/api",W="wss://telemeter.fujiy.dev/api",V="https://telemeter.fujiy.dev/api",U="wss://telemeter.fujiy.dev/api",S="/launch2023",x=1,j=2,F=6,D=5;function P(e){const t=Math.trunc(e/1e7),a=Math.abs(e)%1e7;return`${t}.${a}`}const O={A:{name:"Attitude",entries:{Q:{name:"Quaternion",datatype:"float32",index:["x","y","z","w"]},A:{name:"Accel",unit:"m/s²",datatype:"float32",index:["x","y","z"]},g:{name:"Gyro",unit:"deg/s",datatype:"float32",index:["x","y","z"]},m:{name:"Mag",unit:"mT",datatype:"float32",index:["x","y","z"]}},timeout:.1},P:{name:"GPS",entries:{O:{name:"Longitude",unit:"°",datatype:"int32",format:P},A:{name:"Latitude",unit:"°",datatype:"int32",format:P},H:{name:"Altitude",unit:"m",datatype:"float32"},T:{name:"Time",unit:"s",datatype:"uint32"},S:{name:"Satellites",datatype:"uint8",warning:e=>e<4&&"4 satellites needed"}},timeout:10},B:{name:"Battery",entries:{P:{name:"Vpp",datatype:"float16",unit:"V"},C:{name:"Vcc",datatype:"float16",unit:"V"},D:{name:"Vdd",datatype:"float16",unit:"V"},c:{name:"Vcc",datatype:"float16",unit:"A"},d:{name:"Vdd",datatype:"float16",unit:"A"}},timeout:10},C:{name:"Command",entries:{R:{name:"RSSI",datatype:"uint8",unit:"dB"},C:{name:"Count",datatype:"uint32"}},timeout:10},W:{name:"TWELITE",entries:{Q:{name:"LQI",datatype:"uint8"},S:{name:"Sent",datatype:"uint32"},R:{name:"Received",datatype:"uint32"}},timeout:10},H:{name:"Air",entries:{T:{name:"Temperature",unit:"℃",datatype:"float32",warning:e=>e>40?"Too hot":e<10&&"Too cold"},P:{name:"Pressure",unit:"Pa",datatype:"float32"},A:{name:"Presssure Alt",unit:"m",datatype:"float32"},h:{name:"Humidity",unit:"RH%",datatype:"float32"}},timeout:1},L:{name:"Logger",entries:{t:{name:"Time",unit:"s",datatype:"uint32"},w:{name:"Wrote",datatype:"uint32"},d:{name:"Dropped",datatype:"uint32",warning:e=>e>0&&"Some packets dropped"}},timeout:1},r:{name:"Recovery",entries:{O:{name:"Longitude",unit:"°",datatype:"int32",format:P},A:{name:"Latitude",unit:"°",datatype:"int32",format:P},H:{name:"GPS Alt",unit:"m",datatype:"float32"},h:{name:"Pressure Alt",unit:"m",datatype:"float32"},c:{name:"Command RSSI",unit:"db",datatype:"uint8"},r:{name:"Rocket Tlm RSSI",unit:"db",datatype:"uint8"}},timeout:60}},A=[{from:x,name:"Rocket",ids:["r","A","P","B","H","C","L"]},{from:j,name:"Launcher",ids:["r"]},{from:F,name:"GS1",ids:["P","B"]},{from:D,name:"GS2",ids:["P","B"]}],C=[{title:"Altitude",y:[["R","H","A"],["R","P","H"]],yLabel:"Altitude [m]"},{title:"Accelaraion",y:[["R","A","A",0],["R","A","A",1],["R","A","A",2]],yLabel:"Accelaration [m/s²]"}],H=[{from:x,name:"Rocket",id:"P",lat:"A",lon:"O",color:"#4FC3F7",markerColor:"white"},{from:F,name:"GS1",id:"P",lat:"A",lon:"O",color:"white",markerColor:"white"},{from:D,name:"GS2",id:"P",lat:"A",lon:"O",color:"white",markerColor:"white"}];var L=a(8281);const Z=_,z=W;T().defaults.baseURL=Z,T().defaults.headers.put["Content-Type"]="application/json;charset=utf-8",T().defaults.headers.put["Access-Control-Allow-Origin"]="*";class M{async getSystems(){const e=await T().get("/systems/");return e.data.systems}async getSystem(e){const t=await T().get(`/systems/${e}`,{params:{password:localStorage.password}});return t.data}async putSystem(e){const t=await T().put(`/systems/${e.id}`,null,{params:e});return t.data}async getFlights(e){const t=await T().get(`/systems/${e}/flights/`,{params:{password:localStorage.password}});return t.data.flights.map(this.makeFlight)}async getFlight(e){const t=await T().get(`/flights/${e}`,{params:{password:localStorage.password}});return this.makeFlight(t.data)}async activateFlight(e){const t=await T().put(`/flights/${e}`,null,{params:{password:localStorage.password,activate:!0}});return this.makeFlight(t.data)}async putFlight(e,t,a,l,i,n){const o=await T().put(`/flights/${e}`,null,{params:{password:localStorage.password,name:t,startTime:a||"",launchTime:l||"",endTime:i||"",data:JSON.stringify(n??{})}});return this.makeFlight(o.data)}async postFlight(e,t,a,l){const i=await T().post(`/systems/${e}/flights/`,null,{params:{password:localStorage.password,name:t,startTime:a,endTime:l}});return this.makeFlight(i.data)}async connect(e,t,a,l,i){return new q(e,t,a,l,i).open()}makeFlight(e){const t=Object.assign({},e);return t.startTime=new Date(e.startTime),t.launchTime=new Date(e.launchTime),e.endTime&&(t.endTime=new Date(e.endTime)),t.data={},e.data&&(t.data=JSON.parse(e.data)),t}}const R=20;class q{constructor(e,t,a,l,i){(0,y.Z)(this,"socket",void 0),(0,y.Z)(this,"flightId",void 0),(0,y.Z)(this,"source",void 0),(0,y.Z)(this,"startTime",void 0),(0,y.Z)(this,"endTime",void 0),(0,y.Z)(this,"callback",void 0),(0,y.Z)(this,"timer",void 0),(0,y.Z)(this,"receivedPackets",void 0),this.flightId=e,this.source=t,this.startTime=a,this.endTime=l,this.callback=i??(()=>{}),this.receivedPackets=[]}async open(){return new Promise(((e,t)=>{const a=new URLSearchParams({source:this.source,password:localStorage.password});this.startTime&&a.append("startTime",this.startTime.toISOString()),this.endTime&&a.append("endTime",this.endTime.toISOString()),this.socket=new WebSocket(`${z}/flights/${this.flightId}/packets?${a.toString()}`),this.socket.binaryType="arraybuffer",this.socket.onopen=t=>{e(this)},this.socket.onerror=e=>{console.error(e)},this.socket.onmessage=e=>{this.onMessage(e)},this.socket.onclose=e=>{console.log("closed",e)},this.timer=setInterval((()=>{this.receivedPackets.length>0&&(this.callback(this.receivedPackets),this.receivedPackets=[])}),1e3/R)}))}send(e,t){const a=t.getTime(),l=new ArrayBuffer(256);new DataView(l).setBigInt64(0,BigInt(a),!0);const i=e.encode(new DataView(l,8));this.socket?.send(new DataView(l,0,8+i))}onMessage(e){if(e.data instanceof ArrayBuffer){const t=new ArrayBuffer(256);new Uint8Array(t).set(new Uint8Array(e.data));const a=Number(new DataView(t).getBigInt64(0,!0)),l=new Date(a),i=String.fromCharCode.apply(null,Array.from(new Uint8Array(t,8,8))).split("\0")[0],n=L.Packet.decode(new DataView(t,16));this.receivedPackets.push({packet:n,time:l,source:i})}}close(){this.socket?.close(),clearInterval(this.timer)}}const I=new M;var E=a(588),N=a(1556),B=a(6372),Y=a(1489),$=a(6572),G=a(1332),K=a(1888),J=a(1334),Q=a(3601),X=a(6422),ee=a(3369),te=a(6824),ae=a(8521),le=a(9234),ie=a(8694),ne=a(3140),oe=a(2902);const se={class:"systemlist"};var re=(0,n.aZ)({__name:"SystemListView",setup(e){const t=(0,v.iH)([]),a=(0,v.iH)(!1),l=(0,v.iH)(!1),o=(0,v.qj)({id:null,name:null,password:null,client:null});(0,n.bv)((async()=>{t.value=await I.getSystems(),console.log("systems",t.value)}));const s=async()=>{if(!l.value)return;a.value=!1;const e=await I.putSystem(o);t.value.push(e),localStorage.password=o.password,console.log("new system",o,e)},r=e=>!!e||"Field is required";return(e,u)=>((0,n.wg)(),(0,n.iD)("div",se,[(0,n.Wm)(E.L,{color:"primary",height:"40",elevation:"10"},{default:(0,n.w5)((()=>[(0,n.Wm)(N.o,null,{default:(0,n.w5)((()=>[(0,n.Uk)("Systems")])),_:1})])),_:1}),(0,n.Wm)(ne.O,null,{default:(0,n.w5)((()=>[(0,n.Wm)(ee.K,{fluid:"",class:"d-flex flex-wrap justify-center"},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(t.value,(e=>((0,n.wg)(),(0,n.j4)(Y._,{width:"400",key:e.id,href:e.client,elevation:"6",class:"ma-2"},{default:(0,n.w5)((()=>[(0,n.Wm)(ie.f,{src:e.client+"image",height:"200"},null,8,["src"]),(0,n.Wm)($.E,{class:"text-h5"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,g.zw)(e.name),1)])),_:2},1024),(0,n.Wm)(G.Q,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,g.zw)(e.id),1)])),_:2},1024),(0,n.Wm)(K.Z)])),_:2},1032,["href"])))),128))])),_:1}),(0,n.Wm)(te.o,null,{default:(0,n.w5)((()=>[(0,n.Wm)(Q.B,{modelValue:a.value,"onUpdate:modelValue":u[6]||(u[6]=e=>a.value=e),width:"auto"},{activator:(0,n.w5)((({props:e})=>[(0,n.Wm)(ae.D,null,{default:(0,n.w5)((()=>[(0,n.Wm)(B.T,(0,n.dG)({icon:"mdi-plus",color:"primary"},e),null,16)])),_:2},1024)])),default:(0,n.w5)((()=>[(0,n.Wm)(Y._,{class:"px-10",width:"600"},{default:(0,n.w5)((()=>[(0,n.Wm)($.E,{class:"my-5"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Register New System ")])),_:1}),(0,n.Wm)(X.O,{modelValue:l.value,"onUpdate:modelValue":u[5]||(u[5]=e=>l.value=e),onSubmit:(0,i.iM)(s,["prevent"])},{default:(0,n.w5)((()=>[(0,n.Wm)(oe.hw,{modelValue:o.id,"onUpdate:modelValue":u[0]||(u[0]=e=>o.id=e),label:"ID",rules:[r]},null,8,["modelValue","rules"]),(0,n.Wm)(oe.hw,{modelValue:o.name,"onUpdate:modelValue":u[1]||(u[1]=e=>o.name=e),label:"Name",rules:[r]},null,8,["modelValue","rules"]),(0,n.Wm)(oe.hw,{modelValue:o.password,"onUpdate:modelValue":u[2]||(u[2]=e=>o.password=e),label:"Password",type:"password",rules:[r]},null,8,["modelValue","rules"]),(0,n.Wm)(oe.hw,{modelValue:o.client,"onUpdate:modelValue":u[3]||(u[3]=e=>o.client=e),label:"Client URL"},null,8,["modelValue"]),(0,n.Wm)(J.h,null,{default:(0,n.w5)((()=>[(0,n.Wm)(le.C),(0,n.Wm)(B.T,{color:"primary",onClick:u[4]||(u[4]=e=>a.value=!1)},{default:(0,n.w5)((()=>[(0,n.Uk)("Cancel")])),_:1}),(0,n.Wm)(B.T,{color:"primary",disabled:!l.value,type:"submit"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Register ")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue","onSubmit"])])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})]))}});const ue=re;var me=ue,de=a(6725),ce=(0,n.aZ)({__name:"LoginModal",props:["system"],emits:["login"],setup(e,{emit:t}){const a=e,l=(0,v.iH)(!1),o=(0,v.iH)(!1),s=(0,v.iH)(""),r=async()=>{if(!o.value)return;localStorage.password=s.value,l.value=!1;const e=await I.getSystem(a.system.id);t("login",e)},u=e=>!!e||"Password is required";return(e,t)=>((0,n.wg)(),(0,n.j4)(Q.B,{modelValue:l.value,"onUpdate:modelValue":t[2]||(t[2]=e=>l.value=e),width:"auto"},{activator:(0,n.w5)((({props:e})=>[a.system?.admin?(0,n.kq)("",!0):((0,n.wg)(),(0,n.j4)(B.T,(0,n.dG)({key:0,icon:"mdi-lock"},e),null,16)),a.system?.admin?((0,n.wg)(),(0,n.j4)(B.T,(0,n.dG)({key:1,icon:"mdi-check"},e),null,16)):(0,n.kq)("",!0)])),default:(0,n.w5)((()=>[(0,n.Wm)(Y._,{class:"px-10",width:"600"},{default:(0,n.w5)((()=>[(0,n.Wm)($.E,{class:"my-5"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Login with Password ")])),_:1}),(0,n.Wm)(X.O,{modelValue:o.value,"onUpdate:modelValue":t[1]||(t[1]=e=>o.value=e),onSubmit:(0,i.iM)(r,["prevent"])},{default:(0,n.w5)((()=>[(0,n.Wm)(oe.hw,{modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=e=>s.value=e),label:"Password",type:"password",rules:[u]},null,8,["modelValue","rules"]),(0,n.Wm)(J.h,null,{default:(0,n.w5)((()=>[(0,n.Wm)(le.C),(0,n.Wm)(B.T,{color:"primary",disabled:!o.value,type:"submit"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Login ")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue","onSubmit"])])),_:1})])),_:1},8,["modelValue"]))}});const pe=ce;var fe=pe,he=a(4075),we=a(3121),ge=a(3289),ve=a(8275),ye=a(7754),ke=a(3150),Te=a(2127),be=a(7769),_e=a(9922);const We={class:"system"},Ve={class:"my-5"};var Ue=(0,n.aZ)({__name:"SystemView",setup(e){const t=(0,v.iH)(void 0),a=(0,v.qj)([]),l=(0,n.Fl)((()=>a.find((e=>!e.endTime)))),o=(0,n.Fl)((()=>a.filter((e=>e.endTime)))),s=((0,v.qj)({dialog:!1,form:!1,password:null}),(0,v.qj)({dialog:!1,form:!1,name:"New Flight"})),r=(0,v.qj)({dialog:!1,form:!1,name:null,source:"log",startTime:new Date,file:null,version:"v3",origin:""}),u=(0,w.tv)();(0,n.bv)((async()=>{const e=(0,n.f3)("systemId");try{t.value=await I.getSystem(e),console.log("system",t.value);const l=await I.getFlights(e);for(const e of l)a.push(e);console.log("flights",l)}catch(l){console.log("unknown system",e,l),u.push("/systems")}}));const m=e=>{t.value=e},d=async()=>{if(!s.name)return;console.log(s.name),s.dialog=!1;const e=await I.postFlight(t.value.id,s.name,new Date);console.log("new flight",e),t.value?.activeFlight&&a.push(t.value?.activeFlight),t.value&&(t.value.activeFlight=e)},c=async()=>{if(console.log("file",r.file),!r.file)return;r.dialog=!1;const e={v1:1,v2:2,v3:3}[r.version],l=await L.Packet.decodeLogFile(r.file[0],e);for(const t of l)t.from=t.from??r.origin;if(0==l.length)return;const i=await I.postFlight(t.value.id,r.name,r.startTime,new Date(r.startTime.getTime()+l.at(-1)?.getTime()));console.log("new flight",i),a.push(i);const n=await I.connect(i.id,r.source);for(const t of l)n.send(t,new Date(r.startTime.getTime()+t.getTime()));n.close()},p=async e=>{const t=await I.putFlight(e.id,e.name,e.startTime,e.launchTime,new Date,e.data);a.value=a.map((e=>e.id==t.id?t:e)),console.log(a)},f=async e=>{const t=await I.activateFlight(e.id);a.value=a.map((e=>e.id==t.id?t:e)),console.log(a)},h=e=>!!e||"Field is required",y=e=>e.length<=8||"Length of source name must be smaller than 8",k=e=>e.length<=1||"Origin id must be a charactor",T=e=>{if(!e)return"";const t=new Date(e);return t.toLocaleString()};return(e,a)=>((0,n.wg)(),(0,n.iD)("div",We,[(0,n.Wm)(E.L,{color:"primary",height:"40"},{default:(0,n.w5)((()=>[(0,n.Wm)(B.T,{icon:"mdi-arrow-left",to:"/systems"}),(0,n.Wm)(N.o,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,g.zw)(t.value?.name),1)])),_:1}),(0,n.Wm)((0,v.SU)(fe),{system:t.value,onLogin:m},null,8,["system"])])),_:1}),(0,n.Wm)(ne.O,null,{default:(0,n.w5)((()=>[(0,n.Wm)(Y._,{class:"ma-10"},{default:(0,n.w5)((()=>[(0,n.Wm)(ve.i,null,{default:(0,n.w5)((()=>[(0,n.Wm)(te.o,{class:"d-flex justify-space-between ma-0"},{default:(0,n.w5)((()=>[(0,n.Wm)(ye.b,null,{default:(0,n.w5)((()=>[(0,n.Uk)(" Active Flight ")])),_:1}),t.value?.admin?((0,n.wg)(),(0,n.j4)(Q.B,{key:0,modelValue:s.dialog,"onUpdate:modelValue":a[3]||(a[3]=e=>s.dialog=e),width:"auto"},{activator:(0,n.w5)((({props:e})=>[(0,n.Wm)(B.T,(0,n.dG)(e,{variant:"outlined",color:"primary",class:"ma-2","prepend-icon":"mdi-rocket-launch"}),{default:(0,n.w5)((()=>[(0,n.Uk)(" New Flight ")])),_:2},1040)])),default:(0,n.w5)((()=>[(0,n.Wm)(Y._,{class:"px-10",width:"600"},{default:(0,n.w5)((()=>[(0,n.Wm)($.E,{class:"my-5"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Start New Flight ")])),_:1}),(0,n.Wm)(X.O,{modelValue:s.form,"onUpdate:modelValue":a[2]||(a[2]=e=>s.form=e),onSubmit:(0,i.iM)(d,["prevent"])},{default:(0,n.w5)((()=>[(0,n.Wm)(oe.hw,{modelValue:s.name,"onUpdate:modelValue":a[0]||(a[0]=e=>s.name=e),label:"Name",rules:[h]},null,8,["modelValue","rules"]),(0,n.Wm)(J.h,null,{default:(0,n.w5)((()=>[(0,n.Wm)(le.C),(0,n.Wm)(B.T,{color:"primary",onClick:a[1]||(a[1]=e=>s.dialog=!1)},{default:(0,n.w5)((()=>[(0,n.Uk)(" Cancel")])),_:1}),(0,n.Wm)(B.T,{color:"primary",disabled:!s.name,type:"submit"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Start ")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue","onSubmit"])])),_:1})])),_:1},8,["modelValue"])):(0,n.kq)("",!0)])),_:1}),(0,v.SU)(l)?((0,n.wg)(),(0,n.j4)(ke.l,{key:0,to:"/flight?id="+(0,v.SU)(l).id},(0,n.Nv)({prepend:(0,n.w5)((()=>[(0,n.Wm)(ge.t,{icon:"mdi-rocket-launch",color:"primary"})])),default:(0,n.w5)((()=>[(0,n.Wm)(Te.V,{textContent:(0,g.zw)((0,v.SU)(l).name)},null,8,["textContent"]),(0,n.Wm)(be.o,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,g.zw)(T((0,v.SU)(l).startTime))+" ~ "+(0,g.zw)(T((0,v.SU)(l).endTime)),1)])),_:1})])),_:2},[t.value?.admin?{name:"append",fn:(0,n.w5)((()=>[(0,n.Wm)(B.T,{icon:"mdi-location-exit",onClick:a[4]||(a[4]=(0,i.iM)((e=>p((0,v.SU)(l))),["stop","prevent"]))})])),key:"0"}:void 0]),1032,["to"])):(0,n.kq)("",!0),(0,n.Wm)(he.J,{inset:""}),(0,n.Wm)(te.o,{class:"d-flex justify-space-between ma-0"},{default:(0,n.w5)((()=>[(0,n.Wm)(ye.b,null,{default:(0,n.w5)((()=>[(0,n.Uk)(" Past Flights ")])),_:1}),t.value?.admin?((0,n.wg)(),(0,n.j4)(Q.B,{key:0,modelValue:r.dialog,"onUpdate:modelValue":a[13]||(a[13]=e=>r.dialog=e),width:"auto"},{activator:(0,n.w5)((({props:e})=>[(0,n.Wm)(B.T,(0,n.dG)(e,{variant:"outlined",color:"primary",class:"ma-2","prepend-icon":"mdi-cloud-upload"}),{default:(0,n.w5)((()=>[(0,n.Uk)(" Upload Log File ")])),_:2},1040)])),default:(0,n.w5)((()=>[(0,n.Wm)(Y._,{class:"px-10",width:"600","min-height":"700"},{default:(0,n.w5)((()=>[(0,n.Wm)($.E,{class:"my-5"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Upload Log File ")])),_:1}),(0,n.Wm)(X.O,{modelValue:r.form,"onUpdate:modelValue":a[12]||(a[12]=e=>r.form=e),onSubmit:(0,i.iM)(c,["prevent"])},{default:(0,n.w5)((()=>[(0,n.Wm)(oe.hw,{modelValue:r.name,"onUpdate:modelValue":a[5]||(a[5]=e=>r.name=e),label:"Name",rules:[h]},null,8,["modelValue","rules"]),(0,n._)("div",Ve,[(0,n.Uk)(" Start Date "),(0,n.Wm)((0,v.SU)(de.Z),{modelValue:r.startTime,"onUpdate:modelValue":a[6]||(a[6]=e=>r.startTime=e),"enable-seconds":"",dark:""},null,8,["modelValue"])]),(0,n.Wm)(we.Z,{label:"File input",modelValue:r.file,"onUpdate:modelValue":a[7]||(a[7]=e=>r.file=e),"show-size":"","prepend-icon":"mdi-file"},null,8,["modelValue"]),(0,n.Wm)(_e.r,{modelValue:r.version,"onUpdate:modelValue":a[8]||(a[8]=e=>r.version=e),label:"Log file version",items:["v1","v2","v3"]},null,8,["modelValue"]),(0,n.Wm)(oe.hw,{modelValue:r.source,"onUpdate:modelValue":a[9]||(a[9]=e=>r.source=e),label:"Source name",rules:[h,y]},null,8,["modelValue","rules"]),(0,n.Wm)(oe.hw,{modelValue:r.origin,"onUpdate:modelValue":a[10]||(a[10]=e=>r.origin=e),label:"Default origin",rules:[k]},null,8,["modelValue","rules"]),(0,n.Wm)(J.h,null,{default:(0,n.w5)((()=>[(0,n.Wm)(le.C),(0,n.Wm)(B.T,{color:"primary",onClick:a[11]||(a[11]=e=>r.dialog=!1)},{default:(0,n.w5)((()=>[(0,n.Uk)(" Cancel")])),_:1}),(0,n.Wm)(B.T,{color:"primary",disabled:!r.form,type:"submit"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Upload ")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue","onSubmit"])])),_:1})])),_:1},8,["modelValue"])):(0,n.kq)("",!0)])),_:1}),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)((0,v.SU)(o),(e=>((0,n.wg)(),(0,n.j4)(ke.l,{key:e.name,to:"/flight?id="+e.id},(0,n.Nv)({prepend:(0,n.w5)((()=>[(0,n.Wm)(ge.t,{icon:"mdi-rocket"})])),default:(0,n.w5)((()=>[(0,n.Wm)(Te.V,{textContent:(0,g.zw)(e.name)},null,8,["textContent"]),(0,n.Wm)(be.o,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,g.zw)(T(e.startTime))+" ~ "+(0,g.zw)(T(e.endTime)),1)])),_:2},1024)])),_:2},[t.value?.admin?{name:"append",fn:(0,n.w5)((()=>[(0,n.Wm)(B.T,{icon:"mdi-location-enter",onClick:(0,i.iM)((t=>f(e)),["stop","prevent"])},null,8,["onClick"])])),key:"0"}:void 0]),1032,["to"])))),128))])),_:1})])),_:1})])),_:1})]))}});const Se=Ue;var xe=Se;class je{get startTime(){return this.flight.startTime}get launchTime(){return this.flight.launchTime}get endTime(){return this.flight.endTime}get startT(){return this.time2t(this.startTime)}get launchT(){return this.time2t(this.launchTime)}get endT(){return this.endTime&&this.time2t(this.endTime)}get nowT(){return this.time2t(new Date)}get earliestT(){const e=Math.min.apply(null,this.mapDataseries((e=>e.earliest?.t)).filter((e=>e)));return isFinite(e)?e:void 0}get latestT(){const e=Math.max.apply(null,this.mapDataseries((e=>e.latest?.t)).filter((e=>e)));return isFinite(e)?e:void 0}mapDataseries(e){return Object.values(this.dataseries).flatMap((t=>Object.values(t).map(e)))}constructor(e){(0,y.Z)(this,"flight",void 0),(0,y.Z)(this,"dataseries",void 0),this.flight=e,this.dataseries={}}getBy(e,t){return this.dataseries[e]||(this.dataseries[e]={}),this.dataseries[e][t]||(this.dataseries[e][t]=new Fe(this,e,t)),this.dataseries[e][t]}addPackets(e){const t={};for(const a of e)a.packet.from&&a.packet.id&&(t[a.packet.from]||(t[a.packet.from]={}),t[a.packet.from][a.packet.id]||(t[a.packet.from][a.packet.id]=[]),t[a.packet.from][a.packet.id].push(a));for(const[a,l]of Object.entries(t)){const e=Number(a);this.dataseries[e]||(this.dataseries[e]={});for(const[t,a]of Object.entries(l))this.dataseries[e][t]||(this.dataseries[e][t]=new Fe(this,e,t)),this.dataseries[e][t].addPackets(a.map((e=>(e.unixTime=e.time.getTime(),e))))}}showT(e){const t=Math.abs(e);let a="T";a+=e>=0?"+":"-";const l=Math.round(1e3*t)%1e3,i=Math.floor(t)%60,n=Math.floor(t/60)%60,o=Math.floor(t/60/60)%24,s=Math.floor(t/60/60/24);return s>0&&(a+=s.toString()+" "),o>0&&(a+=o.toString().padStart(2,"0")+":"),a+=n.toString().padStart(2,"0")+":",a+=i.toString().padStart(2,"0")+".",a+=l.toString().padStart(3,"0"),a}time2t(e){return Math.floor(e.getTime()-this.flight.launchTime.getTime())/1e3}t2time(e){return new Date(1e3*(this.flight.launchTime.getTime()/1e3+e))}}class Fe{get sources(){return Object.keys(this.sourceAvailables)}get earliest(){let e;return this.data.length>0&&(e=this.data.at(0)),{id:this.id,packet:e&&e.packet,t:e&&this.datastore.time2t(new Date(e.unixTime)),source:e&&e.source,format:this.format,count:e?1:0}}get latest(){let e;return this.data.length>0&&(e=this.data.at(-1)),{id:this.id,packet:e&&e.packet,t:e&&this.datastore.time2t(new Date(e.unixTime)),source:e&&e.source,format:this.format,count:this.data.length}}constructor(e,t,a){(0,y.Z)(this,"datastore",void 0),(0,y.Z)(this,"from",void 0),(0,y.Z)(this,"id",void 0),(0,y.Z)(this,"format",void 0),(0,y.Z)(this,"data",void 0),(0,y.Z)(this,"times",void 0),(0,y.Z)(this,"values",void 0),(0,y.Z)(this,"sourceAvailables",void 0),(0,y.Z)(this,"cursor",void 0),this.datastore=e,this.from=t,this.id=a,this.format=O[a],this.data=[],this.sourceAvailables={},this.cursor=0,this.times=[],this.values={};for(const l of Object.keys(this.format?.entries??{}))this.values[l]=new Array(this.format.entries[l]?.index?.length??1).fill(0).map((()=>[]))}at(e){const t=this.searchIndex(e.getTime());let a;return t>=0&&(a=this.data[t]),{id:this.id,packet:a&&a.packet,t:a&&this.datastore.time2t(new Date(a.unixTime)),source:a&&a.source,format:this.format,count:a?t+1:0}}getTimes(e,t,a){const l=this.cursor;let i=e&&this.searchIndex(this.datastore.t2time(e).getTime());(!i||i<0)&&(i=0);let n=t&&this.searchIndex(this.datastore.t2time(t).getTime());(!n||n<0)&&(n=this.times.length-1);this.times.slice(i,n);return this.cursor=l,this.times}getValues(e,t=0,a,l,i){const n=this.cursor;if(!this.values[e]||!this.values[e][t])return[];let o=a&&this.searchIndex(this.datastore.t2time(a).getTime());(!o||o<0)&&(o=0);let s=l&&this.searchIndex(this.datastore.t2time(l).getTime());(!s||s<0)&&(s=this.times.length-1);const r=this.values[e][t].slice(o,s);return this.cursor=n,r}addPackets(e){if(0==e.length)return;this.cursor=this.data.length-1,e.sort(((e,t)=>e.unixTime-t.unixTime));const t={};for(const a of e){let e=0,l="";a.packet.entries.forEach(((i,n)=>{if(n==a.packet.entries.length-1&&"t"==i.type)return;i.type==l?e++:e=0,l=i.type;const o=this.format?.entries[i.type];o&&(t[i.type]||(t[i.type]=new Array(o.index?.length??1).fill(0).map((()=>[]))),t[i.type][e]&&t[i.type][e].push(i.formatNumber(o)))}))}for(let a=0;a<e.length;a++){const l=this.searchIndex(e[a].unixTime);if(0==this.data.length||l==this.data.length-1){this.data.push(...e.slice(a)),this.times.push(...e.slice(a).map((e=>this.datastore.time2t(new Date(e.unixTime)))));for(const e of Object.keys(this.format?.entries??{}))t[e]&&t[e].forEach(((t,l)=>{this.values[e][l]&&this.values[e][l].push(...t.slice(a))}));break}this.data.splice(l+1,0,e[a]),this.times.splice(l+1,0,this.datastore.time2t(new Date(e[a].unixTime)));for(const e of Object.keys(this.format?.entries??{}))t[e]&&t[e].forEach(((t,i)=>{this.values[e][i].splice(l+1,0,t[a])}));this.cursor=l}this.cursor=this.data.length-1}searchIndex(e){if(0==this.data.length)return 0;this.data[this.cursor]||(this.cursor=0);let t=.5;if(e<this.data[this.cursor].unixTime){while(e<this.data[this.cursor].unixTime)if(t*=2,this.cursor-=t,this.cursor<0)return this.cursor=0,-1;t/=2}else{while(e>this.data[this.cursor].unixTime)if(t*=2,this.cursor+=t,this.cursor>=this.data.length)return this.cursor=this.data.length-1,this.data.length-1;t/=2}while(t>=1){if(e<this.data[this.cursor].unixTime)this.cursor-=t;else{if(!(e>this.data[this.cursor].unixTime))break;this.cursor+=t}t/=2}return e<this.data[this.cursor].unixTime&&this.cursor--,this.cursor}}const De={class:"my-5"},Pe={class:"my-5"},Oe={class:"my-5"},Ae={class:"my-5"},Ce={class:"my-5"};var He=(0,n.aZ)({__name:"FlightSettings",props:["flight"],emits:["update"],setup(e,{emit:t}){const a=e,l=(0,v.iH)(!1),o=(0,v.iH)(!1),s=(0,v.iH)(""),r=(0,v.iH)(new Date),u=(0,v.iH)(null),m=(0,v.iH)(null),d=(0,v.iH)([{},{}]),c=async()=>{console.log("save",d.value);const e=await I.putFlight(a.flight.id,s.value,r.value,u.value,m.value,{videos:d.value});console.log("save",e),t("update",e)};(0,n.YP)(a,((e,t)=>{s.value=e.flight?.name,r.value=e.flight.startTime,u.value=e.flight.launchTime,m.value=e.flight.endTime,d.value=e.flight.data.videos??[{},{}]}));const p=e=>!!e||"Field is required";return(e,t)=>((0,n.wg)(),(0,n.j4)(Q.B,{modelValue:l.value,"onUpdate:modelValue":t[9]||(t[9]=e=>l.value=e),width:"auto",class:"overflow-visible"},{activator:(0,n.w5)((({props:e})=>[(0,n.Wm)(B.T,(0,n.dG)(e,{size:"x-large",class:"text-capitalize"}),{default:(0,n.w5)((()=>[(0,n.Uk)((0,g.zw)(a.flight?.system?.name)+" - "+(0,g.zw)(a.flight?.name),1)])),_:2},1040)])),default:(0,n.w5)((()=>[(0,n.Wm)(Y._,{class:"px-10",width:"600","min-height":"800"},{default:(0,n.w5)((()=>[(0,n.Wm)($.E,{class:"my-5"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Settings ")])),_:1}),(0,n.Wm)(X.O,{modelValue:o.value,"onUpdate:modelValue":t[8]||(t[8]=e=>o.value=e),onSubmit:(0,i.iM)(c,["prevent"])},{default:(0,n.w5)((()=>[(0,n.Wm)(oe.hw,{modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=e=>s.value=e),label:"Name",rules:[p]},null,8,["modelValue","rules"]),(0,n._)("div",De,[(0,n.Uk)(" Start time "),(0,n.Wm)((0,v.SU)(de.Z),{modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=e=>r.value=e),"enable-seconds":"",dark:""},null,8,["modelValue"])]),(0,n._)("div",Pe,[(0,n.Uk)(" Launch time "),(0,n.Wm)((0,v.SU)(de.Z),{modelValue:u.value,"onUpdate:modelValue":t[2]||(t[2]=e=>u.value=e),"enable-seconds":"",dark:""},null,8,["modelValue"])]),(0,n._)("div",Oe,[(0,n.Uk)(" End time "),(0,n.Wm)((0,v.SU)(de.Z),{modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=e=>m.value=e),"enable-seconds":"",dark:""},null,8,["modelValue"])]),(0,n._)("div",Ae,[(0,n.Uk)(" Video 1 "),(0,n.Wm)(oe.hw,{modelValue:d.value[0].url,"onUpdate:modelValue":t[4]||(t[4]=e=>d.value[0].url=e),label:"URL"},null,8,["modelValue"]),(0,n.Wm)((0,v.SU)(de.Z),{modelValue:d.value[0].startTime,"onUpdate:modelValue":t[5]||(t[5]=e=>d.value[0].startTime=e),"enable-seconds":"",dark:""},null,8,["modelValue"])]),(0,n._)("div",Ce,[(0,n.Uk)(" Video 2 "),(0,n.Wm)(oe.hw,{modelValue:d.value[1].url,"onUpdate:modelValue":t[6]||(t[6]=e=>d.value[1].url=e),label:"URL"},null,8,["modelValue"]),(0,n.Wm)((0,v.SU)(de.Z),{modelValue:d.value[1].startTime,"onUpdate:modelValue":t[7]||(t[7]=e=>d.value[1].startTime=e),"enable-seconds":"",dark:""},null,8,["modelValue"])]),(0,n.Wm)(J.h,null,{default:(0,n.w5)((()=>[(0,n.Wm)(le.C),(0,n.Wm)(B.T,{color:"primary",type:"submit"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Save ")])),_:1})])),_:1})])),_:1},8,["modelValue","onSubmit"])])),_:1})])),_:1},8,["modelValue"]))}});const Le=He;var Ze=Le,ze=a(8303),Me=a.n(ze),Re=a(6119);const qe={key:0};var Ie=(0,n.aZ)({__name:"FlightTimeline",props:["events"],emits:["change-time"],setup(e,{emit:t}){const a=e,l=(0,n.f3)("datastore"),i=(0,v.iH)(!1),o=(0,v.iH)(null),s=(0,v.iH)(null),r=(0,v.iH)(0),u=(0,v.iH)(0),m=(0,v.iH)(100),d={tooltip:"active"},c=(0,n.Fl)((()=>{const e={};if(l.value){e[r.value]={label:"",style:{width:"18px",height:"18px",display:"block",backgroundColor:"#2196F3",transform:"translate(-7px, -7px)"}};for(const t of a.events){const a=l.value.time2t(t.time);a<u.value||m.value<a||(e[Math.round(a.toString())]={label:t.name,style:{width:"8px",height:"8px",display:"block",backgroundColor:"#303030",transform:"translate(-2px, -2px)"}})}}return e})),p=e=>{if(!l.value)return[];const t=l.value.earliestT??l.value.startT,a=l.value.latestT??l.value.endT??l.value.nowT;return[[y(t),y(a),{backgroundColor:"#2196F3"}]]};let f=null,h=null;const w=e=>{f&&(i.value&&(h=r.value+(e-f)/1e3,h>m.value&&(h=m.value),s.value.setValue(h)),l.value&&!l.value.endT&&(m.value=l.value.nowT),r.value<u.value&&s.value.setValue(u.value),r.value>m.value&&s.value.setValue(m.value)),f=e,requestAnimationFrame(w)};(0,n.bv)((()=>{requestAnimationFrame(w)})),(0,n.YP)(r,((e,a)=>{e!=a&&t("change-time",l.value.t2time(r.value))})),(0,n.YP)(o,((e,t)=>{void 0==e?i.value=!1:0==e?(i.value=!1,o.value=null,s.value.setValue(l.value.startT)):1==e&&i.value?(i.value=!1,o.value=null):1==e?i.value=!0:2==e&&(m.value=l.value.endT??l.value.nowT,s.value.setValue(l.value.endT??l.value.nowT),i.value=!0)})),(0,n.YP)(l,((e,t)=>{u.value=e.startT,m.value=e.endT??e.nowT,t||(r.value=l.value.endTime?0:m.value)}));const y=e=>{const t=m.value-u.value,a=(e-u.value)/t*100;return a<0?0:a>100?100:a};return(e,t)=>((0,n.wg)(),(0,n.j4)(ee.K,{id:"timeline",class:"w-screen ma-0 pa-0"},{default:(0,n.w5)((()=>[(0,n.Wm)(te.o,{align:"center"},{default:(0,n.w5)((()=>[(0,n.Wm)(ae.D,{id:"timeline-t"},{default:(0,n.w5)((()=>[(0,v.SU)(l)?((0,n.wg)(),(0,n.iD)("span",qe,(0,g.zw)((0,v.SU)(l).showT(r.value)),1)):(0,n.kq)("",!0)])),_:1}),(0,n.Wm)(ae.D,{"align-self":"start"},{default:(0,n.w5)((()=>[(0,n.Wm)((0,v.SU)(Me()),{id:"timeline-slider",modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),ref_key:"sliderRef",ref:s,min:u.value,max:m.value,interval:.001,process:p,marks:(0,v.SU)(c),"dot-options":d,"drag-on-click":!0,"tooltip-placement":"top","dot-size":[10,10],duration:0,contained:!0},null,8,["modelValue","min","max","interval","marks"])])),_:1}),(0,n.Wm)(ae.D,{id:"timeline-control"},{default:(0,n.w5)((()=>[(0,n.Wm)(Re.f,{modelValue:o.value,"onUpdate:modelValue":t[1]||(t[1]=e=>o.value=e),divided:"",variant:"outlined",color:"primary"},{default:(0,n.w5)((()=>[(0,n.Wm)(B.T,{icon:"mdi-skip-backward"}),i.value?(0,n.kq)("",!0):((0,n.wg)(),(0,n.j4)(B.T,{key:0,icon:"mdi-play"})),i.value?((0,n.wg)(),(0,n.j4)(B.T,{key:1,icon:"mdi-pause"})):(0,n.kq)("",!0),(0,n.Wm)(B.T,{icon:"mdi-skip-forward"})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}))}});const Ee=Ie;var Ne=Ee,Be=a(1209),Ye=a(917),$e=a(4413),Ge=a(678);const Ke={class:"text-left"},Je={key:0,class:"text-right text-error"},Qe={key:1,class:"text-right text-warning"},Xe={key:2,class:"text-right"};var et=(0,n.aZ)({__name:"PacketList",props:["time"],setup(e){const t=e,a=(0,n.f3)("datastore"),l={};A.forEach((e=>{l[e.from]=e.ids}));const i=(0,v.iH)(l),o=(0,n.Fl)((()=>a.value?A.map((e=>{const l=e.ids.map((l=>a.value.getBy(e.from,l)?.at(t.time??new Date))).filter((e=>e));return{data:l,from:e.from,name:e.name}})):[]));(0,n.YP)(o,(()=>{}));const s=(e,t)=>{const a=[];let l=0,i="";return t.entries.forEach(((n,o)=>{if(o==t.entries.length-1&&"t"==n.type)return;n.type==i?l++:l=0,i=n.type;const s=e?.entries[n.type];if(s){let e=s.name;s.index&&(e+=` (${s.index[l]})`),s.unit&&(e+=` [${s.unit}]`);const t=n.format(s);a.push({title:e,value:t,error:s.error&&s.error(t),warning:s.warning&&s.warning(t)})}else a.push({title:n.type,value:n.payload.int32,error:"Unknown entry",warning:null})})),a},r=e=>{if(!e.format.timeout)return 0;const l=a.value.time2t(t.time)-e.t;return l>e.format.timeout?l:0},u=e=>!(!e.format.error||!e.format.error(e.packet))||e.packet.entries.some((t=>{const a=e.format.entries[t.type];return"t"!=t.type&&!a||a&&a.error&&a.error(t.format(a))})),m=e=>!(!e.format.warning||!e.format.warning(e.packet))||e.packet.entries.some((t=>{const a=e.format.entries[t.type];return a&&a.warning&&a.warning(t.format(a))}));return(e,t)=>((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)((0,v.SU)(o),((e,t)=>((0,n.wg)(),(0,n.j4)(Y._,{key:t},{default:(0,n.w5)((()=>[(0,n.Wm)(Be._,null,{prepend:(0,n.w5)((()=>[e.data.some((e=>!e.packet))?((0,n.wg)(),(0,n.j4)(ge.t,{key:0,icon:"mdi-help-circle"})):e.data.some(u)?((0,n.wg)(),(0,n.j4)(ge.t,{key:1,color:"error",icon:"mdi-alert-circle"})):e.data.some(m)?((0,n.wg)(),(0,n.j4)(ge.t,{key:2,color:"warning",icon:"mdi-alert"})):e.data.some(r)?((0,n.wg)(),(0,n.j4)(ge.t,{key:3,color:"warning",icon:"mdi-clock-alert-outline"})):((0,n.wg)(),(0,n.j4)(ge.t,{key:4,icon:"mdi-check",color:"primary"}))])),append:(0,n.w5)((()=>[(0,n.Wm)(B.T,{density:"compact",icon:"mdi-dots-vertical"})])),default:(0,n.w5)((()=>[(0,n.Wm)($.E,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,g.zw)(e.name),1)])),_:2},1024)])),_:2},1024),(0,n.Wm)(K.Z,{class:"pa-0"},{default:(0,n.w5)((()=>[(0,n.Wm)(ve.i,{opened:i.value[e.from],"onUpdate:opened":t=>i.value[e.from]=t},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.data,(e=>((0,n.wg)(),(0,n.j4)(Ye.NU,{key:e.id,value:e.id},{activator:(0,n.w5)((({props:t})=>[(0,n.Wm)(ke.l,(0,g.vs)((0,n.F4)(t)),{prepend:(0,n.w5)((()=>[e.packet?u(e)?((0,n.wg)(),(0,n.j4)(ge.t,{key:1,color:"error",icon:"mdi-alert-circle"})):m(e)?((0,n.wg)(),(0,n.j4)(ge.t,{key:2,color:"warning",icon:"mdi-alert"})):r(e)?((0,n.wg)(),(0,n.j4)(ge.t,{key:3,color:"warning",icon:"mdi-clock-alert-outline"})):((0,n.wg)(),(0,n.j4)(ge.t,{key:4,icon:"mdi-check",color:"primary"})):((0,n.wg)(),(0,n.j4)(ge.t,{key:0,icon:"mdi-help-circle"}))])),default:(0,n.w5)((()=>[e.format?((0,n.wg)(),(0,n.j4)(Te.V,{key:0},{default:(0,n.w5)((()=>[(0,n.Uk)((0,g.zw)(e.format.name),1)])),_:2},1024)):(0,n.kq)("",!0),e.packet?((0,n.wg)(),(0,n.j4)(be.o,{key:1},{default:(0,n.w5)((()=>[(0,n.Uk)((0,g.zw)((0,v.SU)(a).showT(e.t))+" #"+(0,g.zw)(e.count)+" "+(0,g.zw)(e.source),1)])),_:2},1024)):(0,n.kq)("",!0),e.packet?(0,n.kq)("",!0):((0,n.wg)(),(0,n.j4)(be.o,{key:2},{default:(0,n.w5)((()=>[(0,n.Uk)(" N/A ")])),_:1}))])),_:2},1040)])),default:(0,n.w5)((()=>[e.packet?((0,n.wg)(),(0,n.j4)($e.Y,{key:0,density:"compact"},{default:(0,n.w5)((()=>[(0,n._)("tbody",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(s(e.format,e.packet),((e,t)=>((0,n.wg)(),(0,n.j4)(Ge.N,{key:t,text:e.error||e.warning||""},{activator:(0,n.w5)((({props:t})=>[(0,n._)("tr",(0,g.vs)((0,n.F4)((e.error||e.warning)&&t)),[(0,n._)("td",Ke,(0,g.zw)(e.title),1),e.error?((0,n.wg)(),(0,n.iD)("td",Je,(0,g.zw)(e.value),1)):e.warning?((0,n.wg)(),(0,n.iD)("td",Qe,(0,g.zw)(e.value),1)):((0,n.wg)(),(0,n.iD)("td",Xe,(0,g.zw)(e.value),1))],16)])),_:2},1032,["text"])))),128))])])),_:2},1024)):(0,n.kq)("",!0)])),_:2},1032,["value"])))),128))])),_:2},1032,["opened","onUpdate:opened"])])),_:2},1024)])),_:2},1024)))),128))}});const tt=et;var at=tt,lt=a(4618),it=a(5866);const nt={key:0,class:"w-100"};var ot=(0,n.aZ)({__name:"ChartList",props:["range"],setup(e){const t=e;lt.kL.register(lt.Dx,lt.f$,lt.od,lt.jn,lt.u,lt.De,lt.wL),lt.kL.defaults.color="#FFFFFF",lt.kL.defaults.borderColor="#888888";const a=(0,n.f3)("datastore"),l=100,i=(0,v.iH)([]);return(0,n.YP)(a,(()=>{if(!a.value)return[];i.value=C.map((e=>({config:e,data:{datasets:e.y.map((e=>{const i=e[0],n=e[1],o=e[2],s=e[3]??0,r=O[n]?.entries[o],u=a.value.getBy(i,n,t.range?.min,t.range.max,l),m=[],d=u.getTimes(t.range?.min,t.range.max,l),c=u.getValues(o,s);for(let t=0;t<d.length;t++)m.push({x:d[t],y:c[t]});let p=r?.name;return r?.index&&(p+=` (${r.index[s]})`),{label:p,data:m,showLine:!0,fill:!1,pointRadius:0}}))},options:{aspectRatio:1.5,animation:!1,plugins:{title:{display:!1,text:e.title}},scales:{x:{title:{display:!0,text:"t [s]"},min:t.range?.min,max:t.range?.max},y:{title:{display:!0,text:e.yLabel}}},legend:{display:e.y.length>1},parsing:!1,normalized:!0,spanGaps:!0}})))})),(e,t)=>((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(i.value,((e,t)=>((0,n.wg)(),(0,n.j4)(Y._,{key:t,class:"w-100"},{default:(0,n.w5)((()=>[(0,n.Wm)(Be._,{class:"pb-0"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,g.zw)(e.config.title),1)])),_:2},1024),e.data?((0,n.wg)(),(0,n.iD)("div",nt,[(0,n.Wm)((0,v.SU)(it.bp),{data:e.data,options:e.options,class:"pa-3 pt-0"},null,8,["data","options"])])):(0,n.kq)("",!0)])),_:2},1024)))),128))}});const st=ot;var rt=st,ut=a(9772),mt=(0,n.aZ)({__name:"FlightMap",props:["time"],setup(e){const t=e,a=(0,n.f3)("datastore"),l=(0,v.iH)(null),i=(0,v.iH)(18),o=(0,v.iH)([35.7061,139.7071]),s=(0,n.Fl)((()=>a.value?H.flatMap((e=>{const l=a.value.getBy(e.from,e.id).at(t.time??new Date)?.packet;if(!l)return[];const i=O[e.id],n=l.get(e.lat)?.formatNumber(i.entries[e.lat]),o=l.get(e.lon)?.formatNumber(i.entries[e.lon]);return n&&o?[{latlon:[n,o],color:e.markerColor??e.color}]:[]})):[]));const r=(0,v.iH)([]);(0,n.YP)(a,(()=>{a.value&&(r.value=H.flatMap((e=>{const t=a.value.getBy(e.from,e.id),l=t.getValues(e.lat),i=t.getValues(e.lon);return 0==l.length||0==i.length?[]:[{latlons:l.map(((e,t)=>[e,i[t]])),name:e.name,color:e.color}]})))}));let u=!1;return(0,n.m0)((()=>{u||r.value[0]&&r.value[0].latlons[0]&&l.value&&l.value.leafletObject&&(l.value.leafletObject.flyTo(r.value[0].latlons[0],18),u=!0)})),(e,t)=>((0,n.wg)(),(0,n.j4)(Y._,{class:"w-100",style:{"padding-top":"100%",position:"relative"}},{default:(0,n.w5)((()=>[(0,n.Wm)((0,v.SU)(ut.iA),{ref_key:"map",ref:l,zoom:i.value,"onUpdate:zoom":t[0]||(t[0]=e=>i.value=e),center:o.value,style:{position:"absolute",top:"0"}},{default:(0,n.w5)((()=>[(0,n.Wm)((0,v.SU)(ut.Hw),{url:"https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg","layer-type":"base",name:"OpenStreetMap"}),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(r.value,((e,t)=>((0,n.wg)(),(0,n.j4)((0,v.SU)(ut.P6),{key:t,"lat-lngs":e.latlons,color:e.color},null,8,["lat-lngs","color"])))),128)),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)((0,v.SU)(s),((e,t)=>((0,n.wg)(),(0,n.j4)((0,v.SU)(ut.A0),{key:t,"lat-lng":e.latlon,radius:15,color:e.color},null,8,["lat-lng","color"])))),128)),(0,n.Wm)((0,v.SU)(ut.O9),{position:"topright",imperial:!1,metric:!0})])),_:1},8,["zoom","center"])])),_:1}))}});const dt=mt;var ct=dt,pt=a(1666);const ft={class:"system h-screen overflow-hidden"};var ht=(0,n.aZ)({__name:"FlightView",setup(e){const t=(0,v.XI)(void 0),a=(0,n.Fl)((()=>t.value?.flight)),l=(0,n.Fl)((()=>a.value?.system));(0,n.JJ)("datastore",t);const i=(0,v.iH)(new Date),o=(0,v.iH)({});let s;const r=(0,w.yj)(),u=(0,w.tv)(),m=((0,n.FN)(),(0,n.Fl)((()=>t.value&&[{name:"Release",time:t.value?.launchTime}]||[])));(0,n.bv)((async()=>{try{const e=await I.getFlight(r.query.id);t.value=new je(e),t.value.currentTime=e.startTime,s=await I.connect(e.id,"web",e.startTime,void 0,d),console.log("flight",e,s)}catch{console.log("unknown flight",(0,n.f3)("systemId"),r.query.id),u.push("/systems")}})),(0,w.iS)(((e,t)=>{s?.close()}));const d=e=>{console.log("received",e.length),t.value.addPackets(e),(0,v.oR)(t)},c=async e=>{t.value.flight=e,(0,v.oR)(t)},p=e=>{a.value.system=e},f=e=>{i.value=e};return(e,t)=>((0,n.wg)(),(0,n.iD)("div",ft,[(0,n.Wm)(E.L,{color:"primary",height:"40"},{default:(0,n.w5)((()=>[(0,n.Wm)(B.T,{icon:"mdi-arrow-left",to:"/"}),(0,n.Wm)(le.C),(0,n.Wm)((0,v.SU)(Ze),{flight:(0,v.SU)(a),onUpdate:c},null,8,["flight"]),(0,n.Wm)(le.C),(0,n.Wm)((0,v.SU)(fe),{system:(0,v.SU)(l),onLogin:p},null,8,["system"])])),_:1}),(0,v.SU)(a)?((0,n.wg)(),(0,n.j4)(ne.O,{key:0,class:"h-100 overflow-hidden"},{default:(0,n.w5)((()=>[(0,n.Wm)(ee.K,{class:"ma-0 w-screen h-100"},{default:(0,n.w5)((()=>[(0,n.Wm)(te.o,{class:"h-100"},{default:(0,n.w5)((()=>[(0,n.Wm)(ee.K,{id:"graphics-panel",class:"ma-0 pa-0 h-100"},{default:(0,n.w5)((()=>[(0,n.Wm)(te.o,{class:"h-100 ma-0"},{default:(0,n.w5)((()=>[(0,n.Wm)(ae.D,{class:"pa-3 pr-1"},{default:(0,n.w5)((()=>[(0,n.Wm)(te.o,{class:"w-100 pb-4 ma-0"},{default:(0,n.w5)((()=>[(0,n.Wm)((0,v.SU)(ct),{time:i.value},null,8,["time"])])),_:1})])),_:1}),(0,n.Wm)(ae.D,{class:"h-100 pa-3 pr-1",style:{display:"flex","flex-direction":"column"}},{default:(0,n.w5)((()=>[(0,n.Wm)(te.o,{class:"overflow-y-auto w-100 ma-0",style:{"flex-grow":"1","padding-bottom":"50px"}},{default:(0,n.w5)((()=>[(0,n.Wm)((0,v.SU)(rt),{range:o.value},null,8,["range"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,n.Wm)(ae.D,{id:"packets-panel",class:"overflow-y-auto h-100 pb-16"},{default:(0,n.w5)((()=>[(0,n.Wm)(Y._,null,{default:(0,n.w5)((()=>[(0,n.Wm)((0,v.SU)(at),{time:i.value},null,8,["time"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):(0,n.kq)("",!0),(0,n.Wm)(pt.c,{fixed:"",elevation:"20"},{default:(0,n.w5)((()=>[(0,n.Wm)((0,v.SU)(Ne),{events:(0,v.SU)(m),onChangeTime:f},null,8,["events"])])),_:1})]))}});const wt=ht;var gt=wt;const vt=S,yt=[{path:"/",name:"system",component:xe},{path:"/systems",name:"systemlist",component:me},{path:"/flight",name:"flight",component:gt}];console.log("");const kt=(0,w.p7)({history:(0,w.PO)(vt),routes:yt});var Tt=kt;h(),console.log("mode","production",l);const bt=(0,i.ri)(d);bt.provide("systemId",b),bt.use(Tt).use(f).mount("#app")}},t={};function a(l){var i=t[l];if(void 0!==i)return i.exports;var n=t[l]={exports:{}};return e[l].call(n.exports,n,n.exports,a),n.exports}a.m=e,function(){var e=[];a.O=function(t,l,i,n){if(!l){var o=1/0;for(m=0;m<e.length;m++){l=e[m][0],i=e[m][1],n=e[m][2];for(var s=!0,r=0;r<l.length;r++)(!1&n||o>=n)&&Object.keys(a.O).every((function(e){return a.O[e](l[r])}))?l.splice(r--,1):(s=!1,n<o&&(o=n));if(s){e.splice(m--,1);var u=i();void 0!==u&&(t=u)}}return t}n=n||0;for(var m=e.length;m>0&&e[m-1][2]>n;m--)e[m]=e[m-1];e[m]=[l,i,n]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};a.t=function(l,i){if(1&i&&(l=this(l)),8&i)return l;if("object"===typeof l&&l){if(4&i&&l.__esModule)return l;if(16&i&&"function"===typeof l.then)return l}var n=Object.create(null);a.r(n);var o={};e=e||[null,t({}),t([]),t(t)];for(var s=2&i&&l;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((function(e){o[e]=function(){return l[e]}}));return o["default"]=function(){return l},a.d(n,o),n}}(),function(){a.d=function(e,t){for(var l in t)a.o(t,l)&&!a.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}}(),function(){a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce((function(t,l){return a.f[l](e,t),t}),[]))}}(),function(){a.u=function(e){return"js/"+(461===e?"webfontloader":e)+"."+{93:"7d4448a4",153:"41807072",431:"704be2dd",461:"e506e2ed",858:"8e1c553f",891:"c2316474"}[e]+".js"}}(),function(){a.miniCssF=function(e){}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="telemeter:";a.l=function(l,i,n,o){if(e[l])e[l].push(i);else{var s,r;if(void 0!==n)for(var u=document.getElementsByTagName("script"),m=0;m<u.length;m++){var d=u[m];if(d.getAttribute("src")==l||d.getAttribute("data-webpack")==t+n){s=d;break}}s||(r=!0,s=document.createElement("script"),s.charset="utf-8",s.timeout=120,a.nc&&s.setAttribute("nonce",a.nc),s.setAttribute("data-webpack",t+n),s.src=l),e[l]=[i];var c=function(t,a){s.onerror=s.onload=null,clearTimeout(p);var i=e[l];if(delete e[l],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach((function(e){return e(a)})),t)return t(a)},p=setTimeout(c.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=c.bind(null,s.onerror),s.onload=c.bind(null,s.onload),r&&document.head.appendChild(s)}}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.p=""}(),function(){var e={143:0};a.f.j=function(t,l){var i=a.o(e,t)?e[t]:void 0;if(0!==i)if(i)l.push(i[2]);else{var n=new Promise((function(a,l){i=e[t]=[a,l]}));l.push(i[2]=n);var o=a.p+a.u(t),s=new Error,r=function(l){if(a.o(e,t)&&(i=e[t],0!==i&&(e[t]=void 0),i)){var n=l&&("load"===l.type?"missing":l.type),o=l&&l.target&&l.target.src;s.message="Loading chunk "+t+" failed.\n("+n+": "+o+")",s.name="ChunkLoadError",s.type=n,s.request=o,i[1](s)}};a.l(o,r,"chunk-"+t,t)}},a.O.j=function(t){return 0===e[t]};var t=function(t,l){var i,n,o=l[0],s=l[1],r=l[2],u=0;if(o.some((function(t){return 0!==e[t]}))){for(i in s)a.o(s,i)&&(a.m[i]=s[i]);if(r)var m=r(a)}for(t&&t(l);u<o.length;u++)n=o[u],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(m)},l=self["webpackChunktelemeter"]=self["webpackChunktelemeter"]||[];l.forEach(t.bind(null,0)),l.push=t.bind(null,l.push.bind(l))}();var l=a.O(void 0,[998],(function(){return a(390)}));l=a.O(l)})();
//# sourceMappingURL=app.3e55c09f.js.map