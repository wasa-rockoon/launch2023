(function(){"use strict";var e={2580:function(e,t,a){var l={};a.r(l),a.d(l,{apiEndpoint:function(){return _},apiEndpointDev:function(){return U},basePath:function(){return S},charts:function(){return A},mapPaths:function(){return L},packetFormats:function(){return P},packetList:function(){return C},systemId:function(){return b},wsEndpoint:function(){return W},wsEndpointDev:function(){return V}});var n=a(9242),i=a(3396),o=a(7718);function s(e,t){const a=(0,i.up)("router-view");return(0,i.wg)(),(0,i.j4)(o.q,null,{default:(0,i.w5)((()=>[(0,i.Wm)(a)])),_:1})}var r=a(89);const u={},m=(0,r.Z)(u,[["render",s]]);var d=m,c=(a(9773),a(8957));const p={dark:!0,colors:{primary:"#2196F3",background:"#121212",surface:"#303030","primary-darken-1":"#00FF00",secondary:"#0000FF","secondary-darken-1":"#FF0000",info:"#29b6f6",success:"#66bb6a",error:"#f44336",warning:"#ffa726"}};var f=(0,c.Rd)({theme:{defaultTheme:"customTheme",themes:{customTheme:p}}});async function h(){const e=await a.e(461).then(a.t.bind(a,3657,23));e.load({google:{families:["Roboto:100,300,400,500,700,900&display=swap"]}})}var w=a(2483),v=(a(7658),a(7139)),g=a(4870),y=a(7327),k=(a(3767),a(8585),a(8696),a(6265)),T=a.n(k);const b="launch2023",_="https://telemeter.fujiy.dev/api",W="wss://telemeter.fujiy.dev/api",U="https://telemeter.fujiy.dev/api",V="wss://telemeter.fujiy.dev/api",S="/launch2023",x=1,j=2,F=6,D=5;function O(e){const t=Math.trunc(e/1e7),a=Math.abs(e)%1e7;return`${t}.${a}`}const P={A:{name:"Attitude",entries:{Q:{name:"Quaternion",datatype:"float32",index:["x","y","z","w"]},A:{name:"Accel",unit:"m/s²",datatype:"float32",index:["x","y","z"]},g:{name:"Gyro",unit:"deg/s",datatype:"float32",index:["x","y","z"]},m:{name:"Mag",unit:"mT",datatype:"float32",index:["x","y","z"]}},timeout:.1},P:{name:"GPS",entries:{O:{name:"Longitude",unit:"°",datatype:"int32",format:O},A:{name:"Latitude",unit:"°",datatype:"int32",format:O},H:{name:"Altitude",unit:"m",datatype:"float32"},T:{name:"Time",unit:"s",datatype:"uint32"},S:{name:"Satellites",datatype:"uint8",warning:e=>e<4&&"4 satellites needed"}},timeout:10},B:{name:"Battery",entries:{P:{name:"Vpp",datatype:"float16",unit:"V"},C:{name:"Vcc",datatype:"float16",unit:"V"},D:{name:"Vdd",datatype:"float16",unit:"V"},c:{name:"Vcc",datatype:"float16",unit:"A"},d:{name:"Vdd",datatype:"float16",unit:"A"}},timeout:10},C:{name:"Command",entries:{R:{name:"RSSI",datatype:"uint8",unit:"dB"},C:{name:"Count",datatype:"uint32"}},timeout:10},W:{name:"TWELITE",entries:{Q:{name:"LQI",datatype:"uint8"},S:{name:"Sent",datatype:"uint32"},R:{name:"Received",datatype:"uint32"}},timeout:10},a:{name:"Atomsphere",entries:{T:{name:"Temperature",unit:"℃",datatype:"float16",warning:e=>e>40?"Too hot":e<10&&"Too cold"},P:{name:"Pressure",unit:"Pa",datatype:"float32"},A:{name:"Presssure Alt",unit:"m",datatype:"float32"},h:{name:"Humidity",unit:"RH%",datatype:"float32"}},timeout:1},L:{name:"Logger",entries:{t:{name:"Time",unit:"s",datatype:"uint32"},w:{name:"Wrote",datatype:"uint32"},d:{name:"Dropped",datatype:"uint32",warning:e=>e>0&&"Some packets dropped"}},timeout:1},r:{name:"Recovery",entries:{B:{name:"Battery",datatype:"float16",unit:"V"},O:{name:"Longitude",unit:"°",datatype:"int32",format:O},A:{name:"Latitude",unit:"°",datatype:"int32",format:O},H:{name:"GPS Alt",unit:"m",datatype:"float32"},h:{name:"Pressure Alt",unit:"m",datatype:"float32"},c:{name:"Command RSSI",unit:"db",datatype:"uint8"},r:{name:"Rocket Tlm RSSI",unit:"db",datatype:"uint8"}},timeout:60}},C=[{from:x,name:"Rocket",ids:["r","A","P","B","H","C","L"]},{from:j,name:"Launcher",ids:["r"]},{from:F,name:"GS1",ids:["P","B"]},{from:D,name:"GS2",ids:["P","B"]}],A=[{title:"Launcher Altitude",y:[[j,"r","H"],[j,"r","h"]],yLabel:"Altitude [m]"},{title:"Rocket Altitude",y:[[x,"r","H"],[x,"r","h"]],yLabel:"Altitude [m]"}],L=[{from:x,name:"Rocket",id:"P",lat:"A",lon:"O",color:"#4FC3F7",markerColor:"white"},{from:j,name:"Launcher",id:"r",lat:"A",lon:"O",color:"#4FC3F7",markerColor:"white"},{from:F,name:"GS1",id:"P",lat:"A",lon:"O",color:"white",markerColor:"white"},{from:D,name:"GS2",id:"P",lat:"A",lon:"O",color:"white",markerColor:"white"}];var H=a(8281);const Z=_,z=W;T().defaults.baseURL=Z,T().defaults.headers.put["Content-Type"]="application/json;charset=utf-8",T().defaults.headers.put["Access-Control-Allow-Origin"]="*";class M{async getSystems(){const e=await T().get("/systems/");return e.data.systems}async getSystem(e){const t=await T().get(`/systems/${e}`,{params:{password:localStorage.password}});return t.data}async putSystem(e){const t=await T().put(`/systems/${e.id}`,null,{params:e});return t.data}async getFlights(e){const t=await T().get(`/systems/${e}/flights/`,{params:{password:localStorage.password}});return t.data.flights.map(this.makeFlight)}async getFlight(e){const t=await T().get(`/flights/${e}`,{params:{password:localStorage.password}});return this.makeFlight(t.data)}async activateFlight(e){const t=await T().put(`/flights/${e}`,null,{params:{password:localStorage.password,activate:!0}});return this.makeFlight(t.data)}async putFlight(e,t,a,l,n,i){const o=await T().put(`/flights/${e}`,null,{params:{password:localStorage.password,name:t,startTime:a||"",launchTime:l||"",endTime:n||"",data:JSON.stringify(i??{})}});return this.makeFlight(o.data)}async postFlight(e,t,a,l){const n=await T().post(`/systems/${e}/flights/`,null,{params:{password:localStorage.password,name:t,startTime:a,endTime:l}});return this.makeFlight(n.data)}async connect(e,t,a,l,n){return new I(e,t,a,l,n).open()}makeFlight(e){const t=Object.assign({},e);return t.startTime=new Date(e.startTime),t.launchTime=new Date(e.launchTime),e.endTime&&(t.endTime=new Date(e.endTime)),t.data={},e.data&&(t.data=JSON.parse(e.data)),t}}const q=20;class I{constructor(e,t,a,l,n){(0,y.Z)(this,"socket",void 0),(0,y.Z)(this,"flightId",void 0),(0,y.Z)(this,"source",void 0),(0,y.Z)(this,"startTime",void 0),(0,y.Z)(this,"endTime",void 0),(0,y.Z)(this,"callback",void 0),(0,y.Z)(this,"timer",void 0),(0,y.Z)(this,"receivedPackets",void 0),this.flightId=e,this.source=t,this.startTime=a,this.endTime=l,this.callback=n??(()=>{}),this.receivedPackets=[]}async open(){return new Promise(((e,t)=>{const a=new URLSearchParams({source:this.source,password:localStorage.password});this.startTime&&a.append("startTime",this.startTime.toISOString()),this.endTime&&a.append("endTime",this.endTime.toISOString()),this.socket=new WebSocket(`${z}/flights/${this.flightId}/packets?${a.toString()}`),this.socket.binaryType="arraybuffer",this.socket.onopen=t=>{e(this)},this.socket.onerror=e=>{console.error(e)},this.socket.onmessage=e=>{this.onMessage(e)},this.socket.onclose=e=>{console.log("closed",e)},this.timer=setInterval((()=>{this.receivedPackets.length>0&&(this.callback(this.receivedPackets),this.receivedPackets=[])}),1e3/q)}))}send(e,t){const a=t.getTime(),l=new ArrayBuffer(256);new DataView(l).setBigInt64(0,BigInt(a),!0);const n=e.encode(new DataView(l,8));this.socket?.send(new DataView(l,0,8+n))}onMessage(e){if(e.data instanceof ArrayBuffer){const t=new ArrayBuffer(256);new Uint8Array(t).set(new Uint8Array(e.data));const a=Number(new DataView(t).getBigInt64(0,!0)),l=new Date(a),n=String.fromCharCode.apply(null,Array.from(new Uint8Array(t,8,8))).split("\0")[0],i=H.Packet.decode(new DataView(t,16));this.receivedPackets.push({packet:i,time:l,source:n})}}close(){this.socket?.close(),clearInterval(this.timer)}}const E=new M;var R=a(588),N=a(1556),B=a(6372),Y=a(1489),$=a(6572),G=a(1332),K=a(1888),J=a(1334),Q=a(3601),X=a(6422),ee=a(3369),te=a(6824),ae=a(8521),le=a(9234),ne=a(8694),ie=a(3140),oe=a(2902);const se={class:"systemlist"};var re=(0,i.aZ)({__name:"SystemListView",setup(e){const t=(0,g.iH)([]),a=(0,g.iH)(!1),l=(0,g.iH)(!1),o=(0,g.qj)({id:null,name:null,password:null,client:null});(0,i.bv)((async()=>{t.value=await E.getSystems(),console.log("systems",t.value)}));const s=async()=>{if(!l.value)return;a.value=!1;const e=await E.putSystem(o);t.value.push(e),localStorage.password=o.password,console.log("new system",o,e)},r=e=>!!e||"Field is required";return(e,u)=>((0,i.wg)(),(0,i.iD)("div",se,[(0,i.Wm)(R.L,{color:"primary",height:"40",elevation:"10"},{default:(0,i.w5)((()=>[(0,i.Wm)(N.o,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Systems")])),_:1})])),_:1}),(0,i.Wm)(ie.O,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ee.K,{fluid:"",class:"d-flex flex-wrap justify-center"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(t.value,(e=>((0,i.wg)(),(0,i.j4)(Y._,{width:"400",key:e.id,href:e.client,elevation:"6",class:"ma-2"},{default:(0,i.w5)((()=>[(0,i.Wm)(ne.f,{src:e.client+"image",height:"200"},null,8,["src"]),(0,i.Wm)($.E,{class:"text-h5"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,v.zw)(e.name),1)])),_:2},1024),(0,i.Wm)(G.Q,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,v.zw)(e.id),1)])),_:2},1024),(0,i.Wm)(K.Z)])),_:2},1032,["href"])))),128))])),_:1}),(0,i.Wm)(te.o,null,{default:(0,i.w5)((()=>[(0,i.Wm)(Q.B,{modelValue:a.value,"onUpdate:modelValue":u[6]||(u[6]=e=>a.value=e),width:"auto"},{activator:(0,i.w5)((({props:e})=>[(0,i.Wm)(ae.D,null,{default:(0,i.w5)((()=>[(0,i.Wm)(B.T,(0,i.dG)({icon:"mdi-plus",color:"primary"},e),null,16)])),_:2},1024)])),default:(0,i.w5)((()=>[(0,i.Wm)(Y._,{class:"px-10",width:"600"},{default:(0,i.w5)((()=>[(0,i.Wm)($.E,{class:"my-5"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Register New System ")])),_:1}),(0,i.Wm)(X.O,{modelValue:l.value,"onUpdate:modelValue":u[5]||(u[5]=e=>l.value=e),onSubmit:(0,n.iM)(s,["prevent"])},{default:(0,i.w5)((()=>[(0,i.Wm)(oe.hw,{modelValue:o.id,"onUpdate:modelValue":u[0]||(u[0]=e=>o.id=e),label:"ID",rules:[r]},null,8,["modelValue","rules"]),(0,i.Wm)(oe.hw,{modelValue:o.name,"onUpdate:modelValue":u[1]||(u[1]=e=>o.name=e),label:"Name",rules:[r]},null,8,["modelValue","rules"]),(0,i.Wm)(oe.hw,{modelValue:o.password,"onUpdate:modelValue":u[2]||(u[2]=e=>o.password=e),label:"Password",type:"password",rules:[r]},null,8,["modelValue","rules"]),(0,i.Wm)(oe.hw,{modelValue:o.client,"onUpdate:modelValue":u[3]||(u[3]=e=>o.client=e),label:"Client URL"},null,8,["modelValue"]),(0,i.Wm)(J.h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(le.C),(0,i.Wm)(B.T,{color:"primary",onClick:u[4]||(u[4]=e=>a.value=!1)},{default:(0,i.w5)((()=>[(0,i.Uk)("Cancel")])),_:1}),(0,i.Wm)(B.T,{color:"primary",disabled:!l.value,type:"submit"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Register ")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue","onSubmit"])])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})]))}});const ue=re;var me=ue,de=a(6725),ce=(0,i.aZ)({__name:"LoginModal",props:["system"],emits:["login"],setup(e,{emit:t}){const a=e,l=(0,g.iH)(!1),o=(0,g.iH)(!1),s=(0,g.iH)(""),r=async()=>{if(!o.value)return;localStorage.password=s.value,l.value=!1;const e=await E.getSystem(a.system.id);t("login",e)},u=e=>!!e||"Password is required";return(e,t)=>((0,i.wg)(),(0,i.j4)(Q.B,{modelValue:l.value,"onUpdate:modelValue":t[2]||(t[2]=e=>l.value=e),width:"auto"},{activator:(0,i.w5)((({props:e})=>[a.system?.admin?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(B.T,(0,i.dG)({key:0,icon:"mdi-lock"},e),null,16)),a.system?.admin?((0,i.wg)(),(0,i.j4)(B.T,(0,i.dG)({key:1,icon:"mdi-check"},e),null,16)):(0,i.kq)("",!0)])),default:(0,i.w5)((()=>[(0,i.Wm)(Y._,{class:"px-10",width:"600"},{default:(0,i.w5)((()=>[(0,i.Wm)($.E,{class:"my-5"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Login with Password ")])),_:1}),(0,i.Wm)(X.O,{modelValue:o.value,"onUpdate:modelValue":t[1]||(t[1]=e=>o.value=e),onSubmit:(0,n.iM)(r,["prevent"])},{default:(0,i.w5)((()=>[(0,i.Wm)(oe.hw,{modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=e=>s.value=e),label:"Password",type:"password",rules:[u]},null,8,["modelValue","rules"]),(0,i.Wm)(J.h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(le.C),(0,i.Wm)(B.T,{color:"primary",disabled:!o.value,type:"submit"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Login ")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue","onSubmit"])])),_:1})])),_:1},8,["modelValue"]))}});const pe=ce;var fe=pe,he=a(4075),we=a(3121),ve=a(3289),ge=a(8275),ye=a(7754),ke=a(3150),Te=a(2127),be=a(7769),_e=a(9922);const We={class:"system"},Ue={class:"my-5"};var Ve=(0,i.aZ)({__name:"SystemView",setup(e){const t=(0,g.iH)(void 0),a=(0,g.qj)([]),l=(0,i.Fl)((()=>a.find((e=>!e.endTime)))),o=(0,i.Fl)((()=>a.filter((e=>e.endTime)))),s=((0,g.qj)({dialog:!1,form:!1,password:null}),(0,g.qj)({dialog:!1,form:!1,name:"New Flight"})),r=(0,g.qj)({dialog:!1,form:!1,name:null,source:"log",startTime:new Date,file:null,version:"v3",origin:""}),u=(0,w.tv)();(0,i.bv)((async()=>{const e=(0,i.f3)("systemId");try{t.value=await E.getSystem(e),console.log("system",t.value);const l=await E.getFlights(e);for(const e of l)a.push(e);console.log("flights",l)}catch(l){console.log("unknown system",e,l),u.push("/systems")}}));const m=e=>{t.value=e},d=async()=>{if(!s.name)return;console.log(s.name),s.dialog=!1;const e=await E.postFlight(t.value.id,s.name,new Date);console.log("new flight",e),t.value?.activeFlight&&a.push(t.value?.activeFlight),t.value&&(t.value.activeFlight=e)},c=async()=>{if(console.log("file",r.file),!r.file)return;r.dialog=!1;const e={v1:1,v2:2,v3:3}[r.version],l=await H.Packet.decodeLogFile(r.file[0],e);for(const t of l)t.from=t.from??r.origin;if(0==l.length)return;const n=await E.postFlight(t.value.id,r.name,r.startTime,new Date(r.startTime.getTime()+l.at(-1)?.getTime()));console.log("new flight",n),a.push(n);const i=await E.connect(n.id,r.source);for(const t of l)i.send(t,new Date(r.startTime.getTime()+t.getTime()));i.close()},p=async e=>{const t=await E.putFlight(e.id,e.name,e.startTime,e.launchTime,new Date,e.data);a.value=a.map((e=>e.id==t.id?t:e)),console.log(a)},f=async e=>{const t=await E.activateFlight(e.id);a.value=a.map((e=>e.id==t.id?t:e)),console.log(a)},h=e=>!!e||"Field is required",y=e=>e.length<=8||"Length of source name must be smaller than 8",k=e=>e.length<=1||"Origin id must be a charactor",T=e=>{if(!e)return"";const t=new Date(e);return t.toLocaleString()};return(e,a)=>((0,i.wg)(),(0,i.iD)("div",We,[(0,i.Wm)(R.L,{color:"primary",height:"40"},{default:(0,i.w5)((()=>[(0,i.Wm)(B.T,{icon:"mdi-arrow-left",to:"/systems"}),(0,i.Wm)(N.o,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,v.zw)(t.value?.name),1)])),_:1}),(0,i.Wm)((0,g.SU)(fe),{system:t.value,onLogin:m},null,8,["system"])])),_:1}),(0,i.Wm)(ie.O,null,{default:(0,i.w5)((()=>[(0,i.Wm)(Y._,{class:"ma-10"},{default:(0,i.w5)((()=>[(0,i.Wm)(ge.i,null,{default:(0,i.w5)((()=>[(0,i.Wm)(te.o,{class:"d-flex justify-space-between ma-0"},{default:(0,i.w5)((()=>[(0,i.Wm)(ye.b,null,{default:(0,i.w5)((()=>[(0,i.Uk)(" Active Flight ")])),_:1}),t.value?.admin?((0,i.wg)(),(0,i.j4)(Q.B,{key:0,modelValue:s.dialog,"onUpdate:modelValue":a[3]||(a[3]=e=>s.dialog=e),width:"auto"},{activator:(0,i.w5)((({props:e})=>[(0,i.Wm)(B.T,(0,i.dG)(e,{variant:"outlined",color:"primary",class:"ma-2","prepend-icon":"mdi-rocket-launch"}),{default:(0,i.w5)((()=>[(0,i.Uk)(" New Flight ")])),_:2},1040)])),default:(0,i.w5)((()=>[(0,i.Wm)(Y._,{class:"px-10",width:"600"},{default:(0,i.w5)((()=>[(0,i.Wm)($.E,{class:"my-5"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Start New Flight ")])),_:1}),(0,i.Wm)(X.O,{modelValue:s.form,"onUpdate:modelValue":a[2]||(a[2]=e=>s.form=e),onSubmit:(0,n.iM)(d,["prevent"])},{default:(0,i.w5)((()=>[(0,i.Wm)(oe.hw,{modelValue:s.name,"onUpdate:modelValue":a[0]||(a[0]=e=>s.name=e),label:"Name",rules:[h]},null,8,["modelValue","rules"]),(0,i.Wm)(J.h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(le.C),(0,i.Wm)(B.T,{color:"primary",onClick:a[1]||(a[1]=e=>s.dialog=!1)},{default:(0,i.w5)((()=>[(0,i.Uk)(" Cancel")])),_:1}),(0,i.Wm)(B.T,{color:"primary",disabled:!s.name,type:"submit"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Start ")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue","onSubmit"])])),_:1})])),_:1},8,["modelValue"])):(0,i.kq)("",!0)])),_:1}),(0,g.SU)(l)?((0,i.wg)(),(0,i.j4)(ke.l,{key:0,to:"/flight?id="+(0,g.SU)(l).id},(0,i.Nv)({prepend:(0,i.w5)((()=>[(0,i.Wm)(ve.t,{icon:"mdi-rocket-launch",color:"primary"})])),default:(0,i.w5)((()=>[(0,i.Wm)(Te.V,{textContent:(0,v.zw)((0,g.SU)(l).name)},null,8,["textContent"]),(0,i.Wm)(be.o,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,v.zw)(T((0,g.SU)(l).startTime))+" ~ "+(0,v.zw)(T((0,g.SU)(l).endTime)),1)])),_:1})])),_:2},[t.value?.admin?{name:"append",fn:(0,i.w5)((()=>[(0,i.Wm)(B.T,{icon:"mdi-location-exit",onClick:a[4]||(a[4]=(0,n.iM)((e=>p((0,g.SU)(l))),["stop","prevent"]))})])),key:"0"}:void 0]),1032,["to"])):(0,i.kq)("",!0),(0,i.Wm)(he.J,{inset:""}),(0,i.Wm)(te.o,{class:"d-flex justify-space-between ma-0"},{default:(0,i.w5)((()=>[(0,i.Wm)(ye.b,null,{default:(0,i.w5)((()=>[(0,i.Uk)(" Past Flights ")])),_:1}),t.value?.admin?((0,i.wg)(),(0,i.j4)(Q.B,{key:0,modelValue:r.dialog,"onUpdate:modelValue":a[13]||(a[13]=e=>r.dialog=e),width:"auto"},{activator:(0,i.w5)((({props:e})=>[(0,i.Wm)(B.T,(0,i.dG)(e,{variant:"outlined",color:"primary",class:"ma-2","prepend-icon":"mdi-cloud-upload"}),{default:(0,i.w5)((()=>[(0,i.Uk)(" Upload Log File ")])),_:2},1040)])),default:(0,i.w5)((()=>[(0,i.Wm)(Y._,{class:"px-10",width:"600","min-height":"700"},{default:(0,i.w5)((()=>[(0,i.Wm)($.E,{class:"my-5"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Upload Log File ")])),_:1}),(0,i.Wm)(X.O,{modelValue:r.form,"onUpdate:modelValue":a[12]||(a[12]=e=>r.form=e),onSubmit:(0,n.iM)(c,["prevent"])},{default:(0,i.w5)((()=>[(0,i.Wm)(oe.hw,{modelValue:r.name,"onUpdate:modelValue":a[5]||(a[5]=e=>r.name=e),label:"Name",rules:[h]},null,8,["modelValue","rules"]),(0,i._)("div",Ue,[(0,i.Uk)(" Start Date "),(0,i.Wm)((0,g.SU)(de.Z),{modelValue:r.startTime,"onUpdate:modelValue":a[6]||(a[6]=e=>r.startTime=e),"enable-seconds":"",dark:""},null,8,["modelValue"])]),(0,i.Wm)(we.Z,{label:"File input",modelValue:r.file,"onUpdate:modelValue":a[7]||(a[7]=e=>r.file=e),"show-size":"","prepend-icon":"mdi-file"},null,8,["modelValue"]),(0,i.Wm)(_e.r,{modelValue:r.version,"onUpdate:modelValue":a[8]||(a[8]=e=>r.version=e),label:"Log file version",items:["v1","v2","v3"]},null,8,["modelValue"]),(0,i.Wm)(oe.hw,{modelValue:r.source,"onUpdate:modelValue":a[9]||(a[9]=e=>r.source=e),label:"Source name",rules:[h,y]},null,8,["modelValue","rules"]),(0,i.Wm)(oe.hw,{modelValue:r.origin,"onUpdate:modelValue":a[10]||(a[10]=e=>r.origin=e),label:"Default origin",rules:[k]},null,8,["modelValue","rules"]),(0,i.Wm)(J.h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(le.C),(0,i.Wm)(B.T,{color:"primary",onClick:a[11]||(a[11]=e=>r.dialog=!1)},{default:(0,i.w5)((()=>[(0,i.Uk)(" Cancel")])),_:1}),(0,i.Wm)(B.T,{color:"primary",disabled:!r.form,type:"submit"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Upload ")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["modelValue","onSubmit"])])),_:1})])),_:1},8,["modelValue"])):(0,i.kq)("",!0)])),_:1}),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)((0,g.SU)(o),(e=>((0,i.wg)(),(0,i.j4)(ke.l,{key:e.name,to:"/flight?id="+e.id},(0,i.Nv)({prepend:(0,i.w5)((()=>[(0,i.Wm)(ve.t,{icon:"mdi-rocket"})])),default:(0,i.w5)((()=>[(0,i.Wm)(Te.V,{textContent:(0,v.zw)(e.name)},null,8,["textContent"]),(0,i.Wm)(be.o,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,v.zw)(T(e.startTime))+" ~ "+(0,v.zw)(T(e.endTime)),1)])),_:2},1024)])),_:2},[t.value?.admin?{name:"append",fn:(0,i.w5)((()=>[(0,i.Wm)(B.T,{icon:"mdi-location-enter",onClick:(0,n.iM)((t=>f(e)),["stop","prevent"])},null,8,["onClick"])])),key:"0"}:void 0]),1032,["to"])))),128))])),_:1})])),_:1})])),_:1})]))}});const Se=Ve;var xe=Se,je=a(8157);class Fe{get startTime(){return this.flight.startTime}get launchTime(){return this.flight.launchTime}get endTime(){return this.flight.endTime}get startT(){return this.time2t(this.startTime)}get launchT(){return this.time2t(this.launchTime)}get endT(){return this.endTime&&this.time2t(this.endTime)}get nowT(){return this.time2t(new Date)}get earliestT(){const e=Math.min.apply(null,this.mapDataseries((e=>e.earliest?.t)).filter((e=>e)));return isFinite(e)?e:void 0}get latestT(){const e=Math.max.apply(null,this.mapDataseries((e=>e.latest?.t)).filter((e=>e)));return isFinite(e)?e:void 0}mapDataseries(e){return Object.values(this.dataseries).flatMap((t=>Object.values(t).map(e)))}constructor(e){(0,y.Z)(this,"flight",void 0),(0,y.Z)(this,"dataseries",void 0),this.flight=e,this.dataseries={}}getBy(e,t){return this.dataseries[e]||(this.dataseries[e]={}),this.dataseries[e][t]||(this.dataseries[e][t]=new De(this,e,t)),this.dataseries[e][t]}addPackets(e){const t={};for(const a of e)a.packet.from&&a.packet.id&&(t[a.packet.from]||(t[a.packet.from]={}),t[a.packet.from][a.packet.id]||(t[a.packet.from][a.packet.id]=[]),t[a.packet.from][a.packet.id].push(a));for(const[a,l]of Object.entries(t)){const e=Number(a);this.dataseries[e]||(this.dataseries[e]={});for(const[t,a]of Object.entries(l))this.dataseries[e][t]||(this.dataseries[e][t]=new De(this,e,t)),this.dataseries[e][t].addPackets(a.map((e=>(e.unixTime=e.time.getTime(),e))))}}showT(e){const t=Math.abs(e);let a="T";a+=e>=0?"+":"-";const l=Math.round(1e3*t)%1e3,n=Math.floor(t)%60,i=Math.floor(t/60)%60,o=Math.floor(t/60/60)%24,s=Math.floor(t/60/60/24);return s>0&&(a+=s.toString()+" "),o>0&&(a+=o.toString().padStart(2,"0")+":"),a+=i.toString().padStart(2,"0")+":",a+=n.toString().padStart(2,"0")+".",a+=l.toString().padStart(3,"0"),a}time2t(e){return Math.floor(e.getTime()-this.flight.launchTime.getTime())/1e3}t2time(e){return new Date(1e3*(this.flight.launchTime.getTime()/1e3+e))}}class De{get sources(){return Object.keys(this.sourceAvailables)}get earliest(){let e;return this.data.length>0&&(e=this.data.at(0)),{id:this.id,packet:e&&e.packet,t:e&&this.datastore.time2t(new Date(e.unixTime)),source:e&&e.source,format:this.format,count:e?1:0}}get latest(){let e;return this.data.length>0&&(e=this.data.at(-1)),{id:this.id,packet:e&&e.packet,t:e&&this.datastore.time2t(new Date(e.unixTime)),source:e&&e.source,format:this.format,count:this.data.length}}constructor(e,t,a){(0,y.Z)(this,"datastore",void 0),(0,y.Z)(this,"from",void 0),(0,y.Z)(this,"id",void 0),(0,y.Z)(this,"format",void 0),(0,y.Z)(this,"data",void 0),(0,y.Z)(this,"times",void 0),(0,y.Z)(this,"values",void 0),(0,y.Z)(this,"sourceAvailables",void 0),(0,y.Z)(this,"cursor",void 0),this.datastore=e,this.from=t,this.id=a,this.format=P[a],this.data=[],this.sourceAvailables={},this.cursor=0,this.times=[],this.values={};for(const l of Object.keys(this.format?.entries??{}))this.values[l]=new Array(this.format.entries[l]?.index?.length??1).fill(0).map((()=>[]))}at(e){const t=this.searchIndex(e.getTime());let a;return t>=0&&(a=this.data[t]),{id:this.id,packet:a&&a.packet,t:a&&this.datastore.time2t(new Date(a.unixTime)),source:a&&a.source,format:this.format,count:a?t+1:0}}getTimes(e,t,a){const l=this.cursor;let n=e&&this.searchIndex(this.datastore.t2time(e).getTime());(!n||n<0)&&(n=0);let i=t&&this.searchIndex(this.datastore.t2time(t).getTime());(!i||i<0)&&(i=this.times.length-1);this.times.slice(n,i);return this.cursor=l,this.times}getValues(e,t=0,a,l,n){const i=this.cursor;if(!this.values[e]||!this.values[e][t])return[];let o=a&&this.searchIndex(this.datastore.t2time(a).getTime());(!o||o<0)&&(o=0);let s=l&&this.searchIndex(this.datastore.t2time(l).getTime());(!s||s<0)&&(s=this.times.length-1);const r=this.values[e][t].slice(o,s);return this.cursor=i,r}addPackets(e){if(0==e.length)return;this.cursor=this.data.length-1,e.sort(((e,t)=>e.unixTime-t.unixTime));const t={};for(const a of e){let e=0,l="";a.packet.entries.forEach(((n,i)=>{if(i==a.packet.entries.length-1&&"t"==n.type)return;n.type==l?e++:e=0,l=n.type;const o=this.format?.entries[n.type];o&&(t[n.type]||(t[n.type]=new Array(o.index?.length??1).fill(0).map((()=>[]))),t[n.type][e]&&t[n.type][e].push(n.formatNumber(o)))}))}for(let a=0;a<e.length;a++){const l=this.searchIndex(e[a].unixTime);if(0==this.data.length||l==this.data.length-1){this.data.push(...e.slice(a)),this.times.push(...e.slice(a).map((e=>this.datastore.time2t(new Date(e.unixTime)))));for(const e of Object.keys(this.format?.entries??{}))t[e]&&t[e].forEach(((t,l)=>{this.values[e][l]&&this.values[e][l].push(...t.slice(a))}));break}this.data.splice(l+1,0,e[a]),this.times.splice(l+1,0,this.datastore.time2t(new Date(e[a].unixTime)));for(const e of Object.keys(this.format?.entries??{}))t[e]&&t[e].forEach(((t,n)=>{this.values[e][n].splice(l+1,0,t[a])}));this.cursor=l}this.cursor=this.data.length-1}searchIndex(e){if(0==this.data.length)return 0;this.data[this.cursor]||(this.cursor=0);let t=.5;if(e<this.data[this.cursor].unixTime){while(e<this.data[this.cursor].unixTime)if(t*=2,this.cursor-=t,this.cursor<0)return this.cursor=0,-1;t/=2}else{while(e>this.data[this.cursor].unixTime)if(t*=2,this.cursor+=t,this.cursor>=this.data.length)return this.cursor=this.data.length-1,this.data.length-1;t/=2}while(t>=1){if(e<this.data[this.cursor].unixTime)this.cursor-=t;else{if(!(e>this.data[this.cursor].unixTime))break;this.cursor+=t}t/=2}return e<this.data[this.cursor].unixTime&&this.cursor--,this.cursor}}const Oe={class:"my-5"},Pe={class:"my-5"},Ce={class:"my-5"},Ae={class:"my-5"},Le={class:"my-5"};var He=(0,i.aZ)({__name:"FlightSettings",props:["flight"],emits:["update"],setup(e,{emit:t}){const a=e,l=(0,g.iH)(!1),o=(0,g.iH)(!1),s=(0,g.iH)(""),r=(0,g.iH)(new Date),u=(0,g.iH)(null),m=(0,g.iH)(null),d=(0,g.iH)([{},{}]),c=async()=>{console.log("save",d.value);const e=await E.putFlight(a.flight.id,s.value,r.value,u.value,m.value,{videos:d.value});console.log("save",e),t("update",e)};(0,i.YP)(a,((e,t)=>{s.value=e.flight?.name,r.value=e.flight.startTime,u.value=e.flight.launchTime,m.value=e.flight.endTime,d.value=e.flight.data.videos??[{},{}]}));const p=e=>!!e||"Field is required";return(e,t)=>((0,i.wg)(),(0,i.j4)(Q.B,{modelValue:l.value,"onUpdate:modelValue":t[9]||(t[9]=e=>l.value=e),width:"auto",class:"overflow-visible"},{activator:(0,i.w5)((({props:e})=>[(0,i.Wm)(B.T,(0,i.dG)(e,{size:"x-large",class:"text-capitalize"}),{default:(0,i.w5)((()=>[(0,i.Uk)((0,v.zw)(a.flight?.system?.name)+" - "+(0,v.zw)(a.flight?.name),1)])),_:2},1040)])),default:(0,i.w5)((()=>[(0,i.Wm)(Y._,{class:"px-10",width:"600","min-height":"800"},{default:(0,i.w5)((()=>[(0,i.Wm)($.E,{class:"my-5"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Settings ")])),_:1}),(0,i.Wm)(X.O,{modelValue:o.value,"onUpdate:modelValue":t[8]||(t[8]=e=>o.value=e),onSubmit:(0,n.iM)(c,["prevent"])},{default:(0,i.w5)((()=>[(0,i.Wm)(oe.hw,{modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=e=>s.value=e),label:"Name",rules:[p]},null,8,["modelValue","rules"]),(0,i._)("div",Oe,[(0,i.Uk)(" Start time "),(0,i.Wm)((0,g.SU)(de.Z),{modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=e=>r.value=e),"enable-seconds":"",dark:""},null,8,["modelValue"])]),(0,i._)("div",Pe,[(0,i.Uk)(" Launch time "),(0,i.Wm)((0,g.SU)(de.Z),{modelValue:u.value,"onUpdate:modelValue":t[2]||(t[2]=e=>u.value=e),"enable-seconds":"",dark:""},null,8,["modelValue"])]),(0,i._)("div",Ce,[(0,i.Uk)(" End time "),(0,i.Wm)((0,g.SU)(de.Z),{modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=e=>m.value=e),"enable-seconds":"",dark:""},null,8,["modelValue"])]),(0,i._)("div",Ae,[(0,i.Uk)(" Video 1 "),(0,i.Wm)(oe.hw,{modelValue:d.value[0].url,"onUpdate:modelValue":t[4]||(t[4]=e=>d.value[0].url=e),label:"URL"},null,8,["modelValue"]),(0,i.Wm)((0,g.SU)(de.Z),{modelValue:d.value[0].startTime,"onUpdate:modelValue":t[5]||(t[5]=e=>d.value[0].startTime=e),"enable-seconds":"",dark:""},null,8,["modelValue"])]),(0,i._)("div",Le,[(0,i.Uk)(" Video 2 "),(0,i.Wm)(oe.hw,{modelValue:d.value[1].url,"onUpdate:modelValue":t[6]||(t[6]=e=>d.value[1].url=e),label:"URL"},null,8,["modelValue"]),(0,i.Wm)((0,g.SU)(de.Z),{modelValue:d.value[1].startTime,"onUpdate:modelValue":t[7]||(t[7]=e=>d.value[1].startTime=e),"enable-seconds":"",dark:""},null,8,["modelValue"])]),(0,i.Wm)(J.h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(le.C),(0,i.Wm)(B.T,{color:"primary",type:"submit"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Save ")])),_:1})])),_:1})])),_:1},8,["modelValue","onSubmit"])])),_:1})])),_:1},8,["modelValue"]))}});const Ze=He;var ze=Ze,Me=a(8303),qe=a.n(Me),Ie=a(6119);const Ee={key:0};var Re=(0,i.aZ)({__name:"FlightTimeline",props:["events"],emits:["change-time"],setup(e,{emit:t}){const a=e,l=(0,i.f3)("datastore"),n=(0,g.iH)(!1),o=(0,g.iH)(null),s=(0,g.iH)(null),r=(0,g.iH)(0),u=(0,g.iH)(0),m=(0,g.iH)(100),d={tooltip:"active"},c=(0,i.Fl)((()=>{const e={};if(l.value){e[r.value]={label:"",style:{width:"18px",height:"18px",display:"block",backgroundColor:"#2196F3",transform:"translate(-7px, -7px)"}};for(const t of a.events){const a=l.value.time2t(t.time);a<u.value||m.value<a||(e[Math.round(a.toString())]={label:t.name,style:{width:"8px",height:"8px",display:"block",backgroundColor:"#303030",transform:"translate(-2px, -2px)"}})}}return e})),p=e=>{if(!l.value)return[];const t=l.value.earliestT??l.value.startT,a=l.value.latestT??l.value.endT??l.value.nowT;return[[y(t),y(a),{backgroundColor:"#2196F3"}]]};let f=null,h=null;const w=e=>{f&&(n.value&&(h=r.value+(e-f)/1e3,h>m.value&&(h=m.value),s.value.setValue(h)),l.value&&!l.value.endT&&(m.value=l.value.nowT),r.value<u.value&&s.value.setValue(u.value),r.value>m.value&&s.value.setValue(m.value)),f=e,requestAnimationFrame(w)};(0,i.bv)((()=>{requestAnimationFrame(w)})),(0,i.YP)(r,((e,a)=>{e!=a&&t("change-time",l.value.t2time(r.value))})),(0,i.YP)(o,((e,t)=>{void 0==e?n.value=!1:0==e?(n.value=!1,o.value=null,s.value.setValue(l.value.startT)):1==e&&n.value?(n.value=!1,o.value=null):1==e?n.value=!0:2==e&&(m.value=l.value.endT??l.value.nowT,s.value.setValue(l.value.endT??l.value.nowT),n.value=!0)})),(0,i.YP)(l,((e,t)=>{u.value=e.startT,m.value=e.endT??e.nowT,t||(r.value=l.value.endTime?0:m.value)}));const y=e=>{const t=m.value-u.value,a=(e-u.value)/t*100;return a<0?0:a>100?100:a};return(e,t)=>((0,i.wg)(),(0,i.j4)(ee.K,{id:"timeline",class:"w-screen ma-0 pa-0"},{default:(0,i.w5)((()=>[(0,i.Wm)(te.o,{align:"center"},{default:(0,i.w5)((()=>[(0,i.Wm)(ae.D,{id:"timeline-t"},{default:(0,i.w5)((()=>[(0,g.SU)(l)?((0,i.wg)(),(0,i.iD)("span",Ee,(0,v.zw)((0,g.SU)(l).showT(r.value)),1)):(0,i.kq)("",!0)])),_:1}),(0,i.Wm)(ae.D,{"align-self":"start"},{default:(0,i.w5)((()=>[(0,i.Wm)((0,g.SU)(qe()),{id:"timeline-slider",modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),ref_key:"sliderRef",ref:s,min:u.value,max:m.value,interval:.001,process:p,marks:(0,g.SU)(c),"dot-options":d,"drag-on-click":!0,"tooltip-placement":"top","dot-size":[10,10],duration:0,contained:!0},null,8,["modelValue","min","max","interval","marks"])])),_:1}),(0,i.Wm)(ae.D,{id:"timeline-control"},{default:(0,i.w5)((()=>[(0,i.Wm)(Ie.f,{modelValue:o.value,"onUpdate:modelValue":t[1]||(t[1]=e=>o.value=e),divided:"",variant:"outlined",color:"primary"},{default:(0,i.w5)((()=>[(0,i.Wm)(B.T,{icon:"mdi-skip-backward"}),n.value?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(B.T,{key:0,icon:"mdi-play"})),n.value?((0,i.wg)(),(0,i.j4)(B.T,{key:1,icon:"mdi-pause"})):(0,i.kq)("",!0),(0,i.Wm)(B.T,{icon:"mdi-skip-forward"})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}))}});const Ne=Re;var Be=Ne,Ye=a(1209),$e=a(917),Ge=a(4413),Ke=a(678);const Je={class:"text-left"},Qe={key:0,class:"text-right text-error"},Xe={key:1,class:"text-right text-warning"},et={key:2,class:"text-right"};var tt=(0,i.aZ)({__name:"PacketList",props:["time"],setup(e){const t=e,a=(0,i.f3)("datastore"),l={};C.forEach((e=>{l[e.from]=e.ids}));const n=(0,g.iH)(l),o=(0,i.Fl)((()=>a.value?C.map((e=>{const l=e.ids.map((l=>a.value.getBy(e.from,l)?.at(t.time??new Date))).filter((e=>e));return{data:l,from:e.from,name:e.name}})):[]));(0,i.YP)(o,(()=>{}));const s=(e,t)=>{const a=[];let l=0,n="";return t.entries.forEach(((i,o)=>{if(o==t.entries.length-1&&"t"==i.type)return;i.type==n?l++:l=0,n=i.type;const s=e?.entries[i.type];if(s){let e=s.name;s.index&&(e+=` (${s.index[l]})`),s.unit&&(e+=` [${s.unit}]`);const t=i.format(s);a.push({title:e,value:t,error:s.error&&s.error(t),warning:s.warning&&s.warning(t)})}else a.push({title:i.type,value:i.payload.int32,error:"Unknown entry",warning:null})})),a},r=e=>{if(!e.format.timeout)return 0;const l=a.value.time2t(t.time)-e.t;return l>e.format.timeout?l:0},u=e=>!(!e.format.error||!e.format.error(e.packet))||e.packet.entries.some((t=>{const a=e.format.entries[t.type];return"t"!=t.type&&!a||a&&a.error&&a.error(t.format(a))})),m=e=>!(!e.format.warning||!e.format.warning(e.packet))||e.packet.entries.some((t=>{const a=e.format.entries[t.type];return a&&a.warning&&a.warning(t.format(a))}));return(e,t)=>((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)((0,g.SU)(o),((e,t)=>((0,i.wg)(),(0,i.j4)(Y._,{key:t},{default:(0,i.w5)((()=>[(0,i.Wm)(Ye._,null,{prepend:(0,i.w5)((()=>[e.data.some((e=>!e.packet))?((0,i.wg)(),(0,i.j4)(ve.t,{key:0,icon:"mdi-help-circle"})):e.data.some(u)?((0,i.wg)(),(0,i.j4)(ve.t,{key:1,color:"error",icon:"mdi-alert-circle"})):e.data.some(m)?((0,i.wg)(),(0,i.j4)(ve.t,{key:2,color:"warning",icon:"mdi-alert"})):e.data.some(r)?((0,i.wg)(),(0,i.j4)(ve.t,{key:3,color:"warning",icon:"mdi-clock-alert-outline"})):((0,i.wg)(),(0,i.j4)(ve.t,{key:4,icon:"mdi-check",color:"primary"}))])),append:(0,i.w5)((()=>[(0,i.Wm)(B.T,{density:"compact",icon:"mdi-dots-vertical"})])),default:(0,i.w5)((()=>[(0,i.Wm)($.E,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,v.zw)(e.name),1)])),_:2},1024)])),_:2},1024),(0,i.Wm)(K.Z,{class:"pa-0"},{default:(0,i.w5)((()=>[(0,i.Wm)(ge.i,{opened:n.value[e.from],"onUpdate:opened":t=>n.value[e.from]=t},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.data,(e=>((0,i.wg)(),(0,i.j4)($e.NU,{key:e.id,value:e.id},{activator:(0,i.w5)((({props:t})=>[(0,i.Wm)(ke.l,(0,v.vs)((0,i.F4)(t)),{prepend:(0,i.w5)((()=>[e.packet?u(e)?((0,i.wg)(),(0,i.j4)(ve.t,{key:1,color:"error",icon:"mdi-alert-circle"})):m(e)?((0,i.wg)(),(0,i.j4)(ve.t,{key:2,color:"warning",icon:"mdi-alert"})):r(e)?((0,i.wg)(),(0,i.j4)(ve.t,{key:3,color:"warning",icon:"mdi-clock-alert-outline"})):((0,i.wg)(),(0,i.j4)(ve.t,{key:4,icon:"mdi-check",color:"primary"})):((0,i.wg)(),(0,i.j4)(ve.t,{key:0,icon:"mdi-help-circle"}))])),default:(0,i.w5)((()=>[e.format?((0,i.wg)(),(0,i.j4)(Te.V,{key:0},{default:(0,i.w5)((()=>[(0,i.Uk)((0,v.zw)(e.format.name),1)])),_:2},1024)):(0,i.kq)("",!0),e.packet?((0,i.wg)(),(0,i.j4)(be.o,{key:1},{default:(0,i.w5)((()=>[(0,i.Uk)((0,v.zw)((0,g.SU)(a).showT(e.t))+" #"+(0,v.zw)(e.count)+" "+(0,v.zw)(e.source),1)])),_:2},1024)):(0,i.kq)("",!0),e.packet?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(be.o,{key:2},{default:(0,i.w5)((()=>[(0,i.Uk)(" N/A ")])),_:1}))])),_:2},1040)])),default:(0,i.w5)((()=>[e.packet?((0,i.wg)(),(0,i.j4)(Ge.Y,{key:0,density:"compact"},{default:(0,i.w5)((()=>[(0,i._)("tbody",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s(e.format,e.packet),((e,t)=>((0,i.wg)(),(0,i.j4)(Ke.N,{key:t,text:e.error||e.warning||""},{activator:(0,i.w5)((({props:t})=>[(0,i._)("tr",(0,v.vs)((0,i.F4)((e.error||e.warning)&&t)),[(0,i._)("td",Je,(0,v.zw)(e.title),1),e.error?((0,i.wg)(),(0,i.iD)("td",Qe,(0,v.zw)(e.value),1)):e.warning?((0,i.wg)(),(0,i.iD)("td",Xe,(0,v.zw)(e.value),1)):((0,i.wg)(),(0,i.iD)("td",et,(0,v.zw)(e.value),1))],16)])),_:2},1032,["text"])))),128))])])),_:2},1024)):(0,i.kq)("",!0)])),_:2},1032,["value"])))),128))])),_:2},1032,["opened","onUpdate:opened"])])),_:2},1024)])),_:2},1024)))),128))}});const at=tt;var lt=at,nt=a(4618),it=a(5866);const ot={key:0,class:"w-100"};var st=(0,i.aZ)({__name:"ChartList",props:["range"],setup(e){const t=e;nt.kL.register(nt.Dx,nt.f$,nt.od,nt.jn,nt.u,nt.De,nt.wL),nt.kL.defaults.color="#FFFFFF",nt.kL.defaults.borderColor="#888888";const a=(0,i.f3)("datastore"),l=100,n=(0,g.iH)([]),o=()=>{a.value&&(n.value=A.map((e=>({config:e,data:{datasets:e.y.map((e=>{const n=e[0],i=e[1],o=e[2],s=e[3]??0,r=P[i]?.entries[o],u=a.value.getBy(n,i,t.range?.min,t.range.max,l),m=[],d=u.getTimes(t.range?.min,t.range.max,l),c=u.getValues(o,s);for(let t=0;t<d.length;t++)m.push({x:d[t],y:c[t]});let p=r?.name;return r?.index&&(p+=` (${r.index[s]})`),{label:p,data:m,showLine:!0,fill:!1,pointRadius:0}}))},options:{aspectRatio:1.5,animation:!1,plugins:{title:{display:!1,text:e.title}},scales:{x:{title:{display:!0,text:"t [s]"},min:t.range?.min,max:t.range?.max},y:{title:{display:!0,text:e.yLabel}}},legend:{display:e.y.length>1},parsing:!1,normalized:!0,spanGaps:!0,responsive:!0}}))))};return(0,i.YP)(a,o()),(0,i.bv)(o),(e,t)=>((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.value,((e,t)=>((0,i.wg)(),(0,i.j4)(Y._,{key:t,class:"w-100"},{default:(0,i.w5)((()=>[(0,i.Wm)(Ye._,{class:"pb-0"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,v.zw)(e.config.title),1)])),_:2},1024),e.data?((0,i.wg)(),(0,i.iD)("div",ot,[(0,i.Wm)((0,g.SU)(it.bp),{data:e.data,options:e.options,class:"pa-3 pt-0"},null,8,["data","options"])])):(0,i.kq)("",!0)])),_:2},1024)))),128))}});const rt=st;var ut=rt,mt=a(9772),dt=(0,i.aZ)({__name:"FlightMap",props:["time"],setup(e){const t=e,a=(0,i.f3)("datastore"),l=(0,g.iH)(null),o=(0,g.iH)(18),s=(0,i.Fl)((()=>r.value?[r.value.latitude,r.value.longitude]:[35.7061,139.7071])),r=(0,g.iH)(null),u={permanent:!0,direction:"top"},m=(0,i.Fl)((()=>{if(!a.value)return[];let e=L.flatMap((e=>{const l=a.value.getBy(e.from,e.id).at(t.time??new Date)?.packet;if(!l)return[];const n=P[e.id],i=l.get(e.lat)?.formatNumber(n.entries[e.lat]),o=l.get(e.lon)?.formatNumber(n.entries[e.lon]);return i&&o?[{latlon:[i,o],color:e.markerColor??e.color,name:e.name}]:[]}));return r.value&&e.push({latlon:[r.value.latitude,r.value.longitude],color:"white",name:"You"}),e}));const d=(0,g.iH)([]);(0,i.YP)(a,(()=>{a.value&&(d.value=L.flatMap((e=>{const t=a.value.getBy(e.from,e.id),l=t.getValues(e.lat),n=t.getValues(e.lon);return 0==l.length||0==n.length?[]:[{latlons:l.flatMap(((e,t)=>e&&n[t]&&[[e,n[t]]]||[])),name:e.name,color:e.color}]})))}));let c,p=!1;(0,i.m0)((()=>{p||d.value[0]&&d.value[0].latlons[0]&&l.value&&l.value.leafletObject&&(l.value.leafletObject.flyTo(d.value[0].latlons[0],18),p=!0)})),(0,i.bv)((()=>{c=setInterval((()=>{navigator.geolocation.getCurrentPosition((e=>{r.value=e.coords}))}),1e3)})),(0,i.Ah)((()=>{clearInterval(c)}));const f=e=>{},h=()=>{DeviceOrientationEvent.requestPermission(),window.addEventListener("deviceorientation",f,!0)},w=()=>{};return(e,t)=>((0,i.wg)(),(0,i.j4)(Y._,{class:"w-100",style:{"padding-top":"100%",position:"relative"},onTouchstart:(0,n.iM)(w,["stop"]),onClick:h},{default:(0,i.w5)((()=>[(0,i.Wm)((0,g.SU)(mt.iA),{ref_key:"map",ref:l,zoom:o.value,"onUpdate:zoom":t[0]||(t[0]=e=>o.value=e),center:(0,g.SU)(s),style:{position:"absolute",top:"0"}},{default:(0,i.w5)((()=>[(0,i.Wm)((0,g.SU)(mt.Hw),{url:"https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg","layer-type":"base",name:"OpenStreetMap"}),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(d.value,((e,t)=>((0,i.wg)(),(0,i.j4)((0,g.SU)(mt.P6),{key:t,"lat-lngs":e.latlons,color:e.color},null,8,["lat-lngs","color"])))),128)),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)((0,g.SU)(m),((e,t)=>((0,i.wg)(),(0,i.j4)((0,g.SU)(mt.A0),{key:t,"lat-lng":e.latlon,name:e.name,radius:10,color:e.color},{default:(0,i.w5)((()=>[(0,i.Wm)((0,g.SU)(mt.Gs),{content:e.name,options:u},null,8,["content"])])),_:2},1032,["lat-lng","name","color"])))),128)),(0,i.Wm)((0,g.SU)(mt.O9),{position:"topright",imperial:!1,metric:!0})])),_:1},8,["zoom","center"])])),_:1},8,["onTouchstart"]))}});const ct=dt;var pt=ct,ft=a(1666),ht=a(3144),wt=a(9870),vt=a(6161),gt=a(4722);const yt={class:"system h-screen overflow-hidden"};var kt=(0,i.aZ)({__name:"FlightView",setup(e){const t=(0,g.XI)(void 0),a=(0,i.Fl)((()=>t.value?.flight)),l=(0,i.Fl)((()=>a.value?.system));(0,i.JJ)("datastore",t);const n=(0,g.iH)(new Date),o=(0,g.iH)({});let s;const r=(0,w.yj)(),u=(0,w.tv)(),m=((0,i.FN)(),(0,je.AW)()),d=(0,g.iH)(null),c=(0,i.Fl)((()=>t.value&&[{name:"Release",time:t.value?.launchTime}]||[]));(0,i.bv)((async()=>{try{const e=await E.getFlight(r.query.id);t.value=new Fe(e),t.value.currentTime=e.startTime,s=await E.connect(e.id,"web",e.startTime,void 0,p),console.log("flight",e,s)}catch{console.log("unknown flight",(0,i.f3)("systemId"),r.query.id),u.push("/systems")}})),(0,w.iS)(((e,t)=>{s?.close()}));const p=e=>{console.log("received",e.length),t.value.addPackets(e),(0,g.oR)(t)},f=async e=>{t.value.flight=e,(0,g.oR)(t)},h=e=>{a.value.system=e},v=e=>{n.value=e};return(e,t)=>((0,i.wg)(),(0,i.iD)("div",yt,[(0,i.Wm)(R.L,{color:"primary",height:"40"},(0,i.Nv)({default:(0,i.w5)((()=>[(0,i.Wm)(B.T,{icon:"mdi-arrow-left",to:"/"}),(0,i.Wm)(le.C),(0,i.Wm)((0,g.SU)(ze),{flight:(0,g.SU)(a),onUpdate:f},null,8,["flight"]),(0,i.Wm)(le.C),(0,i.Wm)((0,g.SU)(fe),{system:(0,g.SU)(l),onLogin:h},null,8,["system"])])),_:2},[(0,g.SU)(m).smAndDown.value?{name:"extension",fn:(0,i.w5)((()=>[(0,i.Wm)(ht.d,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=e=>d.value=e),"fixed-tabs":"",class:"w-100"},{default:(0,i.w5)((()=>[(0,i.Wm)(wt.L,{value:"map"},{default:(0,i.w5)((()=>[(0,i.Uk)("Map")])),_:1}),(0,i.Wm)(wt.L,{value:"charts"},{default:(0,i.w5)((()=>[(0,i.Uk)("Charts")])),_:1}),(0,i.Wm)(wt.L,{value:"packets"},{default:(0,i.w5)((()=>[(0,i.Uk)("Packets")])),_:1})])),_:1},8,["modelValue"])])),key:"0"}:void 0]),1024),(0,g.SU)(a)?((0,i.wg)(),(0,i.j4)(ie.O,{key:0,class:"h-100 overflow-hidden"},{default:(0,i.w5)((()=>[((0,i.wg)(),(0,i.j4)(i.Ob,{class:"h-100"},[(0,g.SU)(m).smAndDown.value?((0,i.wg)(),(0,i.j4)(ee.K,{key:0,class:"h-100 pa-0 pb-16"},{default:(0,i.w5)((()=>[(0,i.Wm)(vt.Oo,{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=e=>d.value=e),class:"overflow-y-auto h-100 pa-3"},{default:(0,i.w5)((()=>[(0,i.Wm)(gt.H,{value:"map"},{default:(0,i.w5)((()=>[(0,i.Wm)(te.o,{class:"w-100 pb-4 ma-0"},{default:(0,i.w5)((()=>[(0,i.Wm)((0,g.SU)(pt),{time:n.value},null,8,["time"])])),_:1})])),_:1}),(0,i.Wm)(gt.H,{value:"charts",class:"overflow-y-auto"},{default:(0,i.w5)((()=>[(0,i.Wm)((0,g.SU)(ut),{range:o.value},null,8,["range"])])),_:1}),(0,i.Wm)(gt.H,{value:"packets"},{default:(0,i.w5)((()=>[(0,i.Wm)(Y._,null,{default:(0,i.w5)((()=>[(0,i.Wm)((0,g.SU)(lt),{time:n.value},null,8,["time"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})):((0,i.wg)(),(0,i.j4)(ee.K,{key:1,class:"ma-0 w-screen h-100"},{default:(0,i.w5)((()=>[(0,i.Wm)(te.o,{class:"h-100"},{default:(0,i.w5)((()=>[(0,i.Wm)(ae.D,{class:"pa-3 pr-1",cols:"4"},{default:(0,i.w5)((()=>[(0,i.Wm)(te.o,{class:"w-100 pb-4 ma-0"},{default:(0,i.w5)((()=>[(0,i.Wm)((0,g.SU)(pt),{time:n.value},null,8,["time"])])),_:1})])),_:1}),(0,i.Wm)(ae.D,{class:"pa-3 pr-1 overflow-y-auto h-100",cols:"4"},{default:(0,i.w5)((()=>[(0,i.Wm)(Y._,null,{default:(0,i.w5)((()=>[(0,i.Wm)((0,g.SU)(ut),{range:o.value},null,8,["range"])])),_:1})])),_:1}),(0,i.Wm)(ae.D,{class:"overflow-y-auto h-100 pb-16",cols:"4"},{default:(0,i.w5)((()=>[(0,i.Wm)(Y._,null,{default:(0,i.w5)((()=>[(0,i.Wm)((0,g.SU)(lt),{time:n.value},null,8,["time"])])),_:1})])),_:1})])),_:1})])),_:1}))],1024))])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(ft.c,{fixed:"",elevation:"20"},{default:(0,i.w5)((()=>[(0,i.Wm)((0,g.SU)(Be),{events:(0,g.SU)(c),onChangeTime:v},null,8,["events"])])),_:1})]))}});const Tt=kt;var bt=Tt;const _t=S,Wt=[{path:"/",name:"system",component:xe},{path:"/systems",name:"systemlist",component:me},{path:"/flight",name:"flight",component:bt}];console.log("");const Ut=(0,w.p7)({history:(0,w.PO)(_t),routes:Wt});var Vt=Ut;h(),console.log("mode","production",l);const St=(0,n.ri)(d);St.provide("systemId",b),St.use(Vt).use(f).mount("#app")}},t={};function a(l){var n=t[l];if(void 0!==n)return n.exports;var i=t[l]={exports:{}};return e[l].call(i.exports,i,i.exports,a),i.exports}a.m=e,function(){var e=[];a.O=function(t,l,n,i){if(!l){var o=1/0;for(m=0;m<e.length;m++){l=e[m][0],n=e[m][1],i=e[m][2];for(var s=!0,r=0;r<l.length;r++)(!1&i||o>=i)&&Object.keys(a.O).every((function(e){return a.O[e](l[r])}))?l.splice(r--,1):(s=!1,i<o&&(o=i));if(s){e.splice(m--,1);var u=n();void 0!==u&&(t=u)}}return t}i=i||0;for(var m=e.length;m>0&&e[m-1][2]>i;m--)e[m]=e[m-1];e[m]=[l,n,i]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};a.t=function(l,n){if(1&n&&(l=this(l)),8&n)return l;if("object"===typeof l&&l){if(4&n&&l.__esModule)return l;if(16&n&&"function"===typeof l.then)return l}var i=Object.create(null);a.r(i);var o={};e=e||[null,t({}),t([]),t(t)];for(var s=2&n&&l;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((function(e){o[e]=function(){return l[e]}}));return o["default"]=function(){return l},a.d(i,o),i}}(),function(){a.d=function(e,t){for(var l in t)a.o(t,l)&&!a.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}}(),function(){a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce((function(t,l){return a.f[l](e,t),t}),[]))}}(),function(){a.u=function(e){return"js/"+(461===e?"webfontloader":e)+"."+{93:"7d4448a4",153:"41807072",431:"704be2dd",461:"e506e2ed",858:"8e1c553f",891:"c2316474"}[e]+".js"}}(),function(){a.miniCssF=function(e){}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="telemeter:";a.l=function(l,n,i,o){if(e[l])e[l].push(n);else{var s,r;if(void 0!==i)for(var u=document.getElementsByTagName("script"),m=0;m<u.length;m++){var d=u[m];if(d.getAttribute("src")==l||d.getAttribute("data-webpack")==t+i){s=d;break}}s||(r=!0,s=document.createElement("script"),s.charset="utf-8",s.timeout=120,a.nc&&s.setAttribute("nonce",a.nc),s.setAttribute("data-webpack",t+i),s.src=l),e[l]=[n];var c=function(t,a){s.onerror=s.onload=null,clearTimeout(p);var n=e[l];if(delete e[l],s.parentNode&&s.parentNode.removeChild(s),n&&n.forEach((function(e){return e(a)})),t)return t(a)},p=setTimeout(c.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=c.bind(null,s.onerror),s.onload=c.bind(null,s.onload),r&&document.head.appendChild(s)}}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.p=""}(),function(){var e={143:0};a.f.j=function(t,l){var n=a.o(e,t)?e[t]:void 0;if(0!==n)if(n)l.push(n[2]);else{var i=new Promise((function(a,l){n=e[t]=[a,l]}));l.push(n[2]=i);var o=a.p+a.u(t),s=new Error,r=function(l){if(a.o(e,t)&&(n=e[t],0!==n&&(e[t]=void 0),n)){var i=l&&("load"===l.type?"missing":l.type),o=l&&l.target&&l.target.src;s.message="Loading chunk "+t+" failed.\n("+i+": "+o+")",s.name="ChunkLoadError",s.type=i,s.request=o,n[1](s)}};a.l(o,r,"chunk-"+t,t)}},a.O.j=function(t){return 0===e[t]};var t=function(t,l){var n,i,o=l[0],s=l[1],r=l[2],u=0;if(o.some((function(t){return 0!==e[t]}))){for(n in s)a.o(s,n)&&(a.m[n]=s[n]);if(r)var m=r(a)}for(t&&t(l);u<o.length;u++)i=o[u],a.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return a.O(m)},l=self["webpackChunktelemeter"]=self["webpackChunktelemeter"]||[];l.forEach(t.bind(null,0)),l.push=t.bind(null,l.push.bind(l))}();var l=a.O(void 0,[998],(function(){return a(2580)}));l=a.O(l)})();
//# sourceMappingURL=app.34d0079e.js.map